var daterangepicker_format=$('meta[name="daterangepicker_format"]').attr("content"),datepicker_format=$('meta[name="datepicker_format"]').attr("content"),php_date_format=$('meta[name="php_date_format"]').attr("content");$(".header_refinement").removeClass("active"),$('.header_refinement[data = "Homes"]').addClass("active"),$(".header_refinement_modal").removeClass("active"),$('.header_refinement_modal[data = "Homes"]').addClass("active"),$(".home_pro").show(),$(".exp_cat").hide(),guests_select_option("#modal_guests","Homes"),guests_select_option("#header-search-guests","Homes");var prop_app_fil="",amen_app_fil="",broom_app_fil="",bed_app_fil="",bath_app_fil="",search_on_map="";map_search_first="",$(".map.hide-sm-view").hide(),$(".search-results").show(),$("body").addClass("pos-fixed"),$(".filter-div").hide(),$(".sidebar").scroll(function(){$(".sidebar").scrollTop()>=$(".filters.collapse").height()?$(".sidebar-header").addClass("fixed-header"):$(".sidebar-header").removeClass("fixed-header")}),$(window).resize(function(){$(".sidebar-header").removeClass("fixed-header")}),$(".sidebar").scroll(function(){$("#ui-datepicker-div").hide()}),$(".customBox").hover(function(){$(mark).addClass("hover")}),$(document).ready(function(){$("label.toggle .toggle__handle").click(function(){$("label.toggle").toggleClass("toggle--checked");var e="Off"==$("label.toggle .toggle__handle span").text()?"On":"Off";$("label.toggle .toggle__handle span").html(e)})}),app.directive("postsPagination",function(){return{restrict:"E",template:'<ul class="pagination"><li ng-show="currentPage != 1"><a href="javascript:void(0)" ng-click="search_result(1)">&laquo;</a></li><li ng-show="currentPage != 1"><a href="javascript:void(0)" ng-click="search_result(currentPage-1)">&lsaquo; '+$("#pagin_prev").val()+'</a></li><li ng-repeat="i in range" ng-class="{active : currentPage == i}"><a href="javascript:void(0)" ng-click="search_result(i)">{{i}}</a></li><li ng-show="currentPage != totalPages"><a href="javascript:void(0)" ng-click="search_result(currentPage+1)">'+$("#pagin_next").val()+' &rsaquo;</a></li><li ng-show="currentPage != totalPages"><a href="javascript:void(0)" ng-click="search_result(totalPages)">&raquo;</a></li></ul>'}}).controller("search-page",["$scope","$http","$compile","$filter",function(e,t,a,i){function o(){$(window).width()<1025?($(document).on("click",".button_ipunk",function(){$(".map.hide-sm-view").show(),$(".search-results").hide(),$("body").addClass("pos-fixed"),$(".button_ipunk").hide(),$(".button_ipunk-result").show(),$(".filter-div").hide(),$(".hide-sm-view").addClass("loading"),e.search_result()}),$(".button_ipunk-result").click(function(){$(".button_ipunk").show(),$(".button_ipunk-result").hide(),$(".map.hide-sm-view").hide(),$(".search-results").show(),$(".filter-div").hide()}),$(".button_ipunk4").click(function(){})):($(".search-results").show(),$("body").removeClass("pos-fixed"))}e.first_search="Yes",e.current_date=new Date,e.totalPages=0,e.currentPage=1,e.range=[],e.marker_click=0,e.map_lat_long="",e.map_fit_bounds="",$(window).resize(function(){$(window).width()<1025?$("#more_filter_submit").html("See Homes"):$("#more_filter_submit").html("Apply filters"),o()}),$(window).ready(function(){$(window).width()<1025?$("#more_filter_submit").html("See Homes"):$("#more_filter_submit").html("Apply filters"),o()}),$(window).ready(function(){$(window).width()});var r=moment($("#checkin").val(),daterangepicker_format).toDate();new Date($("#checkin").val());var s=moment($("#checkout").val(),daterangepicker_format).toDate();new Date($("#checkout").val());var n=new Date;if(start=moment(),$(".clear_date").daterangepicker({locale:{cancelLabel:"Clear"}}),$(".dates_clear").click(function(){m("checkin",""),m("checkout",""),location.reload()}),$(".dbdate").daterangepicker({autoUpdateInput:!1,locale:{format:daterangepicker_format,cancelLabel:CLEAR_LANG,applyLabel:APPLY_LANG},minDate:n,dateLimitMin:{days:1}}),$(".dbdate").on("cancel.daterangepicker",function(){e.checkin?(e.checkin="",e.checkout="",e.search_result()):(e.checkin="",e.checkout=""),$(".dbdate").removeClass("active"),$(".gut5").removeClass("active");var t=$("#checkin,.dbdate, .gut5").data("daterangepicker");t.setStartDate(n),t.setEndDate("")}),$(".mobile_date_clear").click(function(t,a){(a=$(".gut5").data("daterangepicker")).setStartDate(n),a.setEndDate(""),e.checkin?(e.checkin="",e.checkout="",e.search_result()):(e.checkin="",e.checkout=""),$(".gut5").removeClass("active"),$("#checkin").val(""),$("#checkout").val(""),setTimeout(function(){var e=$(".gut5").data("daterangepicker");e.setStartDate(n),e.setEndDate("")},2e3)}),$(".gut5").daterangepicker({autoApply:!0,minDate:n,dateLimitMin:{days:1},autoUpdateInput:!1,locale:{format:daterangepicker_format},parentEl:"#daterangepicker_modal_div",alwaysShowCalendars:!0,inline:!0}),"Invalid Date"!=r&&"Invalid Date"!=s){var l=$("#checkin,.dbdate, .gut5").data("daterangepicker");l.setStartDate(r),l.setEndDate(s)}function c(){$(".search-results").hasClass("loading")?$("#no_results").hide():$("#no_results").show()}function d(){"none"==$(".search-results").css("display")&&$(".map").addClass("loading")}$("#checkin,.dbdate").on("show.daterangepicker",function(e,t){$(this).parent().parent().find(".DateRangePickerDiv").parent().css("cssText","opacity: 1 !important"),$(".morefit").hide(),$(".map,.sidesear").removeClass("mapfil"),$(".guestbut1").hide(),$(".sidebar").removeClass("newdp")}),$("#checkin,.dbdate").on("apply.daterangepicker",function(t,a){startDateInput=$("#checkin"),endDateInput=$("#checkout"),startDate=a.startDate,endDate=a.endDate,e.checkin=startDate.format(daterangepicker_format),e.checkout=endDate.format(daterangepicker_format),startDateInput.val(startDate.format(daterangepicker_format)),endDateInput.val(endDate.format(daterangepicker_format)),e.search_result()}),$("#checkin,.dbdate").on("hide.daterangepicker",function(e,t){t.startDate&&t.endDate||($(this).parent().css("opacity",1),$(this).parent().parent().find(".DateRangePickerDiv").parent().css("cssText","opacity: 0 !important"))}),$("#checkout").daterangepicker({autoApply:!0,minDate:n,dateLimitMin:{days:1},autoUpdateInput:!1,locale:{format:daterangepicker_format}}),$("#checkout").on("show.daterangepicker",function(e,t){$(this).parent().parent().find(".DateRangePickerDiv").parent().css("cssText","opacity: 1 !important")}),$("#checkout").on("apply.daterangepicker",function(t,a){startDateInput=$("#checkin"),endDateInput=$("#checkout"),startDate=a.startDate,endDate=a.endDate,e.checkin=startDate.format(daterangepicker_format),e.checkout=endDate.format(daterangepicker_format),startDateInput.val(startDate.format(daterangepicker_format)),endDateInput.val(endDate.format(daterangepicker_format)),e.search_result()}),$("#checkout").on("hide.daterangepicker",function(e,t){t.startDate&&t.endDate||($(this).parent().css("opacity",1),$(this).parent().parent().find(".DateRangePickerDiv").parent().css("cssText","opacity: 0 !important"))}),$(document).on("click",'[id^="wishlist-widget-icon-"]',function(){if("object"==typeof USER_ID)return t.get(APP_URL+"/wishlist_list",{}).then(function(e){window.location.href=APP_URL+"/login"}),!1;var a=$(this).data("name"),i=$(this).data("img"),o=$(this).data("address"),r=$(this).data("host_img");e.room_id=$(this).data("room_id"),$(".background-listing-img").css("background-image","url("+i+")"),$(".host-profile-img").attr("src",r),$(".wl-modal-listing__name").text(a),$(".wl-modal-listing__address").text(o),$(".wl-modal-footer__input").val(o),$(".wl-modal__col").removeClass("hide-md"),$(".wl-modal__modal").removeClass("hide"),$(".wl-modal__col:nth-child(2)").addClass("hide"),$(".row-margin-zero").append('<div id="wish-list-signup-container" style="overflow-y:auto;" class="col-lg-5 wl-modal__col-collapsible"> <div class="loading wl-modal__col"> </div> </div>'),t.get(APP_URL+"/wishlist_list?id="+$(this).data("room_id")+"&type="+$(this).data("what"),{}).then(function(t){$("#wish-list-signup-container").remove(),$(".wl-modal__col:nth-child(2)").removeClass("hide"),e.wishlist_list=t.data})}),e.wishlist_row_select=function(a){t.post(APP_URL+"/save_wishlist",{data:e.room_id,wishlist_id:e.wishlist_list[a].id,saved_id:e.wishlist_list[a].saved_id}).then(function(t){"null"==t.data?e.wishlist_list[a].saved_id=null:e.wishlist_list[a].saved_id=t.data}),$("#wishlist_row_"+a).hasClass("text-dark-gray")?e.wishlist_list[a].saved_id=null:e.wishlist_list[a].saved_id=1},$(document).on("submit",".wl-modal-footer__form",function(a){a.preventDefault(),$(".wl-modal__col:nth-child(2)").addClass("hide"),$(".row-margin-zero").append('<div id="wish-list-signup-container" style="overflow-y:auto;" class="col-lg-5 wl-modal__col-collapsible"> <div class="loading wl-modal__col"> </div> </div>'),t.post(APP_URL+"/wishlist_create",{data:$(".wl-modal-footer__input").val(),id:e.room_id}).then(function(t){$(".wl-modal-footer__form").addClass("hide"),$("#wish-list-signup-container").remove(),$(".wl-modal__col:nth-child(2)").removeClass("hide"),e.wishlist_list=t.data,a.preventDefault()}),a.preventDefault()}),$(".wl-modal__modal-close").click(function(){i("filter")(e.wishlist_list,{saved_id:null}).length==e.wishlist_list.length?$("#wishlist-widget-"+e.room_id).prop("checked",!1):$("#wishlist-widget-"+e.room_id).prop("checked",!0),$(".wl-modal__modal").addClass("hide")}),$(document).ready(function(){e.map_lat_long="";var t=[];$(".room-type:checked").each(function(e){t[e]=$(this).val()});var a=[];$(".property_type:checked").each(function(e){a[e]=$(this).val()});var i=[];$(".amenities:checked").each(function(e){i[e]=$(this).val()}),$(".search_tag").addClass("hide"),""!=t&&$(".room-type_tag").removeClass("hide"),""!=i&&$(".amenities_tag").removeClass("hide"),""!=a&&$(".property_type_tag").removeClass("hide");var o=$("#location").val();$("#header-search-form").val(o),$("#modal-locations").val(o);var r=document.getElementById("slider");if("ar"==$("html").attr("lang"))var s="rtl";else s="ltr";noUiSlider.create(r,{start:[min_slider_price_value,max_slider_price_value],connect:!0,step:1,margin:2,direction:s,range:{min:min_slider_price,max:max_slider_price}});document.getElementById("min_text"),document.getElementById("max_text");r.noUiSlider.on("update",function(e,t){t?$("#max_text").html(parseInt(e[t])):$("#min_text").html(parseInt(e[t]))}),r.noUiSlider.on("change",function(t,a){$("#min_value").val(parseInt(t[0])),$("#min_text").html(parseInt(t[0])),max_slider_price==parseInt(t[1])?$("#max_text").html(parseInt(t[1])+"+"):$("#max_text").html(parseInt(t[1])),$("#max_value").val(parseInt(t[1])),$(".max_value").val(parseInt(t[1])),$(".min_value").val(parseInt(t[0])),e.update_filter_status()});var n=document.getElementById("mobslider");if("ar"==$("html").attr("lang"))s="rtl";else s="ltr";noUiSlider.create(n,{start:[min_slider_price_value,max_slider_price_value],connect:!0,step:1,margin:2,direction:s,range:{min:min_slider_price,max:max_slider_price}});document.getElementById("min_text1"),document.getElementById("max_text1");n.noUiSlider.on("update",function(e,t){t?$("#max_text1").text(parseInt(e[t])):$("#min_text1").text(parseInt(e[t]))}),n.noUiSlider.on("change",function(t,a){$("#min_value1").val(parseInt(t[0])),$("#min_text1").text(parseInt(t[0])),max_slider_price==parseInt(t[1])?$("#max_text1").html(parseInt(t[1])+"+"):$("#max_text1").html(parseInt(t[1])),$("#max_value1").val(parseInt(t[1])),$(".max_value").val(parseInt(t[1])),$(".min_value").val(parseInt(t[0])),e.update_filter_status()}),$(".show-more").click(function(){$(this).children("span").toggleClass("hide"),$(this).parent().parent().children("div").children().toggleClass("filters-more")}),$("#more_filters").click(function(){$(".toggle-group").css("display","block"),$(".toggle-hide").css("display","none"),$(".sidebar").css("height","87%")})});p("location"),window.location.href.replace("/s","/searchResult");function m(e,t){var a=window.location.href;if(a.indexOf(e+"=")>=0){var i=a.substring(0,a.indexOf(e)),o=a.substring(a.indexOf(e));a=i+e+"="+t+(o=(o=o.substring(o.indexOf("=")+1)).indexOf("&")>=0?o.substring(o.indexOf("&")):"")}else a.indexOf("?")<0?a+="?"+e+"="+t:a+="&"+e+"="+t;history.pushState(null,null,a)}function p(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(location.search);return null===t?"":decodeURIComponent(t[1].replace(/\+/g," "))}pageNumber=1,void 0===pageNumber&&(pageNumber="1"),$(".search-results").addClass("loading"),d(),c(),e.on_mouse=function(e){null!=y[e]&&(mark=y[e].div_,$(mark).addClass("hover"))},e.out_mouse=function(e){null!=y[e]&&(mark=y[e].div_,$(mark).removeClass("hover"))},e.setParams=function(){var e=$("#max_value").val();m("min_price",$("#min_value").val()),m("max_price",e)},e.search_result=function(i){void 0===i&&(i="1");var o=$(".max_value").val(),r=$(".min_value").val();is_mobile=!($(window).width()>767),filter_location=is_mobile?".morefit1 ":".home_filter ";var s=[];$(filter_location+".room-type:checked").each(function(e){s[e]=$(this).val()}),""==s&&$(".room-type_tag").addClass("hide"),filter_location=is_mobile?".morefit1 ":".morefit ";var n=[];$(filter_location+".property_type:checked").each(function(e){n[e]=$(this).val()}),""==n&&$(".property_type_tag").addClass("hide");var l=[];$(filter_location+".amenities:checked").each(function(e){l[e]=$(this).val()}),""==l&&$(".amenities_tag").addClass("hide"),s.length&&(s=jQuery.unique(s)),n.length&&(n=jQuery.unique(n)),l.length&&(l=jQuery.unique(l));var _=e.checkin,h=e.checkout,u=e.search_bedrooms,g=e.search_beds,f=e.search_bath,k=e.search_guest;if(null!=k&&""!=k||(k=1),""!=$.trim(e.map_lat_long)&&""!=search_on_map)var C=e.map_lat_long;else C="";instant_book=e.instant_book,m("room_type",s),m("current_refinement",current_refinement),m("property_type",n),m("amenities",l),m("checkin",_),m("checkout",h),m("guests",k),m("beds",g),m("bathrooms",f),m("bedrooms",u),m("min_price",r),m("max_price",o),m("page",i),m("instant_book",instant_book),m("php_date_format",php_date_format),$(".search_tag").addClass("hide"),""!=s&&$(".room-type_tag").removeClass("hide"),""!=l&&$(".amenities_tag").removeClass("hide"),""!=n&&$(".property_type_tag").removeClass("hide");var I=p("location");$(".search-results").addClass("loading"),d(),c(),t.post("searchResult?page="+i,{location:I,min_price:r,max_price:o,amenities:l,property_type:n,room_type:s,beds:g,bathrooms:f,bedrooms:u,checkin:_,checkout:h,guest:k,map_details:C,instant_book:instant_book}).then(function(t){$(".hide-sm-view").removeClass("loading"),e.room_result=t.data,e.checkin=_,e.checkout=h,e.totalPages=t.data.last_page,e.currentPage=t.data.current_page;for(var i=[],o=1;o<=t.data.last_page;o++)i.push(o);var r=p("amenities"),s=p("property_type");$(window).width()>760&&(""!=r&&""!=s||$("#more_filter_submit").attr("disabled","disabled")),$(".search-results").removeClass("loading"),e.range=i;var n=new google.maps.LatLngBounds;angular.forEach(t.data.data,function(e,t){var a=e.rooms_address.latitude,i=e.rooms_address.longitude;n.extend(new google.maps.LatLng(a,i))}),e.map_fit_bounds="Yes",($(window).width()>760||"Yes"!=e.first_search)&&(t.data.total>0&&""==search_on_map?(e.viewport=n,e.cLat=t.data.data[0].rooms_address.latitude,e.cLong=t.data.data[0].rooms_address.longitude,map_search_first="Yes",x(n)):""==search_on_map&&(e.viewport=e.locationViewport,e.cLat=e.locationLat,e.cLong=e.locationLong,x())),$(".search-results").removeClass("loading"),"Yes"==e.first_search&&(e.first_search="No",$(".button_ipunk").show(),$(".button_ipunk-result").hide(),$(".map.hide-sm-view").hide(),$(".search-results").show(),$(".filter-div").hide()),$(".map").removeClass("loading"),c(),function(t){var i=e.checkout,o=e.checkin,r=e.guests;(function(e){null!=v&&v.isOpen()&&(v.close(),v=new InfoBubble({maxWidth:3e3}));for(var t=0;t<y.length;t++)y[t].setMap(e)})(null),y=[],angular.forEach(t.data,function(t){var s='<div id="info_window_'+t.id+'" class="listing listing-map-popover" data-price="'+t.rooms_price.currency.symbol+'" data-id="'+t.id+'" data-user="'+t.user_id+'" data-url="/rooms/'+t.id+'" data-name="'+t.name+'" data-lng="'+t.rooms_address.longitude+'" data-lat="'+t.rooms_address.latitude+'"><div class="panel-image listing-img">';s+='<a class="media-photo media-cover" target="listing_'+t.id+'" href="'+APP_URL+"/rooms/"+t.id+"?checkin="+o+"&checkout="+i+"&guests="+r+'"><div class="listing-img-container search_page_map media-cover text-center"><img id="marker_image_'+t.id+'" class="marker_image_'+t.id+'" rooms_image = "" alt="'+t.name+'" class="img-responsive-height" data-current="0" src="'+t.photo_name+'"></div></a>',s+='<div class="target-prev target-control block-link marker_slider" ng-click="marker_slider($event)"  data-room_id="'+t.id+'"><i class="icon icon-chevron-left icon-size-2 icon-white"></i></div><a class="link-reset panel-overlay-bottom-left panel-overlay-label panel-overlay-listing-label" target="listing_'+t.id+'" href="'+APP_URL+"/rooms/"+t.id+"?checkin="+o+"&checkout="+i+"&guests="+r+'"><div>';var n="",l=t.beds>1?e.beds_text:e.bed_text,c=e.per_night;"instant_book"==t.booking_type&&(n='<span aria-label="Book Instantly" data-behavior="tooltip" class="h3 icon-beach"><i class="icon icon-instant-book icon-flush-sides"></i></span>'),s+='</div></a><div class="target-next target-control marker_slider block-link" ng-click="marker_slider($event)" data-room_id="'+t.id+'"><i class="icon icon-chevron-right icon-size-2 icon-white"></i></div></div>',s+='<div class="panel-body panel-card-section"><a class="text-normal link-reset pull-left"target="listing_'+t.id+'" href="'+APP_URL+"/rooms/"+t.id+"?checkin="+o+"&checkout="+i+"&guests="+r+'"><span class="category_city hm_cate"><span class="pull-left">'+t.room_type_name+'</span><span class="pull-left dot-cont">路</span><span class="pull-left">'+t.beds+" "+l+'</span></span><br><div class="media"><h3 class="h5 listing-name text-truncate row-space-top-1" itemprop="name" title="'+t.name+'">'+t.name+"</h3>",s+='<div class="exp_price">'+t.rooms_price.currency.symbol+'<span ng-if="'+r+">1 && "+r+">"+t.rooms_price.guests+'"ng-bind-html="'+t.rooms_price.night+"+("+t.rooms_price.additional_guest+"*("+r+"-"+t.rooms_price.guests+'))"></span><span ng-if="'+r+"==1 || "+r+"<="+t.rooms_price.guests+'" ng-bind-html="'+t.rooms_price.night+'"></span> '+c,"instant_book"==t.booking_type&&(s+='<span> <i class="icon icon-instant-book icon-beach h4"></i></span>'),s+="</div>";var d="";""!=t.overall_star_rating&&(d=""+t.overall_star_rating);var m="",p="",_=t.reviews_count>1?e.reviews_text:e.review_text;0!=t.reviews_count&&(m=" "+t.reviews_count+" "+_,p="."),s+='<div class="text-muted listing-location text-truncate pull-left" itemprop="description">',s+='<span class="pull-left">'+d+'</span><span class="pull-left dot-cont">'+p+'</span><span class="pull-left">'+m+"</span></div></div></a></div></div>";var h=t.rooms_address.latitude,u=t.rooms_address.longitude,g=new google.maps.LatLng(h,u),f=t.name,$=t.rooms_price.currency.symbol;if(r>1&&r>t.rooms_price.guests)var k=t.rooms_price.night+t.rooms_price.additional_guest*(r-t.rooms_price.guests);else var k=t.rooms_price.night;var w=new google.maps.Marker({position:g,map:b,icon:L("normal"),title:f,zIndex:1});customTxt=$+k,"instant_book"==t.booking_type&&(customTxt=$+k+n),txt=new D(g,customTxt,"customBox",b),y.push(txt),google.maps.event.addListener(w,"mouseover",function(){w.setIcon(L("hover"))}),google.maps.event.addListener(w,"mouseout",function(){w.setIcon(L("normal"))}),function(t,i){v=new InfoBubble({maxWidth:3e3});var o=a(i)(e);google.maps.event.addListener(t,"click",function(){var a=navigator.userAgent;-1==a.indexOf("iPhone")&&-1==a.indexOf("iPad")&&-1==a.indexOf("Android")||(e.marker_click=1),v.isOpen()&&(v.close(),v=new InfoBubble({maxWidth:3e3})),v.addTab("",o[0]);v.setBorderRadius(0);v.setMaxWidth(300);v.setMaxHeight(300);v.setMinWidth(282);v.setMinHeight(245),v.setPosition(t.pos),v.open(b)})}(txt,s)}),angular.forEach(e.place_result,function(t){var a=t.latitude,i=t.longitude,o=new google.maps.LatLng(a,i),r=new Marker({map:b,position:o,icon:" ",map_icon_label:getMarkerLabel(t.type)});y.push(r),place_info="<p>"+t.name+"</p><p>"+t.address_line_1+" "+t.address_line_2+", "+t.city+"</p><p>"+t.state+", "+t.country+"</p>",e.places_info.push(place_info),w='<div style="font-size:16px"><h3 style="margin:0px; color:#000;">'+t.name+'</h3><div class="popup-review">'+t.reviews_star_rating_div+'</div><div class="address-align">'+t.address_line_1+'</div><div class="address-align">'+t.address_line_2+'</div><div class="address-align">'+t.city+'</div><div class="address-align">'+t.state+'</div><div class="address-align">'+t.country_name+'</div><div class="address-align">'+t.postal_code+"</div>",w+='<br><br><a class="review-btn-pop" href="'+APP_URL+"/add_place_reviews/place/"+t.id+'" target="_blank" >Review</a>',w+='<div class="review-search-popup"><div onclick="reviews_popup(event, this)" class="close" >close</div>',angular.forEach(t.reviews,function(e){w+='<div class="review-content flt-left">',w+='<div class="left-blk review-content-blk" ><img width="40" height="40" src="'+e.users_from.profile_picture.src+'" class="flt-left img-rnd" ></div>',w+='<div class="right-blk review-content-blk" ><div class="place_comments">'+e.place_comments+'</div><div class="place_stars" >'+e.place_review_stars_div+"</div></div>",w+="</div>"}),function(e,t){v=new InfoBubble({maxWidth:1500});var a=t;google.maps.event.addListener(e,"click",function(){v.isOpen()&&(v.close(),v=new InfoBubble({maxWidth:1500})),v.addTab("",a);v.setBorderRadius(0);v.setMaxWidth(300);v.setMaxHeight(250);v.setMinWidth(300);v.setMinHeight(250),v.open(b,e)})}(r,w+="</div></div></div></div>")})}(t.data)})},e.apply_filter=function(){$(window).width()<760?($(".search-results").show(),$(".filter-div").hide()):($('[id^="map-search"]').each(function(){$(this).hasClass("property_type")&&1==$(this).prop("checked")?prop_app_fil=""==prop_app_fil?$(this).val():prop_app_fil+","+$(this).val():$(this).hasClass("amenities")&&1==$(this).prop("checked")&&(amen_app_fil=""==amen_app_fil?$(this).val():amen_app_fil+","+$(this).val())}),broom_app_fil=$("#map-search-min-bedrooms").val(),bath_app_fil=$("#map-search-min-bathrooms").val(),bed_app_fil=$("#map-search-min-beds").val(),$(".toggle-hide").css("display","block"),$(".toggle-group").css("display","none"),e.search_result())},e.remove_filter=function(t){$("."+t).removeAttr("checked");m(t.replace("-","_"),""),$("."+t+"_tag").addClass("hide"),e.search_result()},e.format_date=function(e,t){return moment(e,daterangepicker_format).format(daterangepicker_format)},e.filter_status=[],e.filter_text=[],e.update_filter_status=function(){room_types_length=$('[id^="room_type_"]:checked').length,min_price=$("#min_text").html()-0,max_price=$("#max_text").html()-0,min_price1=$("#min_text1").html()-0,max_price1=$("#max_text1").html()-0,more_filters_count=0,e.search_bedrooms>0&&more_filters_count++,e.search_beds>0&&more_filters_count++,e.search_bath>0&&more_filters_count++,more_filters_amenities_length=$('[id^="amenities_"]:checked').length,more_filters_property_length=$('[id^="property_"]:checked').length,more_filters_count+=more_filters_amenities_length,more_filters_count+=more_filters_property_length,filters_count=0,filters_count+=$('[id^="mob_room_type_"]:checked').length,filters_count+=$('[id^="mob_amenities_"]:checked').length,filters_count+=$('[id^="mob_property_"]:checked').length,e.search_bedrooms>0&&filters_count++,e.search_beds>0&&filters_count++,e.search_bath>0&&filters_count++,(min_price1>min_slider_price||max_price1<max_slider_price)&&filters_count++,"0"!=e.instant_book&&filters_count++,e.filter_status.dates=!(!e.checkin||!e.checkout),e.filter_status.guests=e.search_guest>1,e.filter_status.room_types=room_types_length>0,e.filter_status.prices=min_price>min_slider_price||max_price<max_slider_price,e.filter_status.instant_book="0"!=e.instant_book,e.filter_status.more_filters=more_filters_count>0,e.filter_status.filters=filters_count>0,price_text="",min_price>min_slider_price&&max_price<max_slider_price?price_text=e.currency_symbol+min_price+" - "+e.currency_symbol+max_price:min_price>min_slider_price?price_text=e.currency_symbol+min_price+"+ ":max_price<max_slider_price&&(price_text="Up to "+e.currency_symbol+max_price),e.filter_text.room_types=" 路 "+room_types_length,e.filter_text.prices=price_text,e.filter_text.more_filters=" 路 "+more_filters_count,e.filter_text.filters=" 路 "+filters_count,e.filter_text.filters_count=filters_count,e.$$phase||e.$apply(),e.guests=e.search_guest},$(document).ready(function(){e.update_filter_status()}),$(".guestbut").click(function(){e.update_filter_status()}),$(".room-type, .property_type, .amenities").click(function(){e.update_filter_status()}),e.filter_btn_text=function(t){return e.update_filter_status(),btn_text=e.filter_text[t],btn_text},e.is_filter_active=function(t){return e.update_filter_status(),result=!1,result=e.filter_status[t],result},e.filter_active=function(t){return is_active=e.is_filter_active(t)||e.opened_filter==t,class_name=is_active?"active":"",class_name},e.update_opened_filter=function(t){e.opened_filter==t?e.reset_filters(t):e.opened_filter=t},e.apply_filters=function(t){if($(".morefit5").hide(),$(".morefit3").hide(),$(".morefit2").hide(),$(".morefit1").hide(),$(".morefit").hide(),$(".hide-sm-view").addClass("loading"),$(".map,.sidesear").removeClass("mapfil"),$(".guestbut1").hide(),$(".sidebar").removeClass("newdp"),$("body").removeClass("non_scrl"),$("body").removeClass("pos-fix3"),"dates"==t&&(l=$(".gut5").data("daterangepicker"),startDateInput=$("#checkin"),endDateInput=$("#checkout"),startDate=l.startDate,endDate=l.endDate,e.checkin=startDate.format(daterangepicker_format),e.checkout=endDate.format(daterangepicker_format),startDateInput.val(startDate.format(daterangepicker_format)),endDateInput.val(endDate.format(daterangepicker_format))),"location_refinement"==t){var a=$("#header-search-form-mob").val(),i="";if(a&&(i=a.replace("","+")),m("location",i),p("current_refinement")!=current_refinement)return m("current_refinement",current_refinement),window.location.reload(),!0;$("#search-modal--sm").addClass("hide"),$("#search-modal--sm").attr("aria-hidden","true")}e.search_result(),e.opened_filter="",e.update_filter_status()},e.reset_filters=function(t){"dates"==t&&(l=$(".gut5").data("daterangepicker"),startDateInput=$("#checkin"),endDateInput=$("#checkout"),startDate=startDateInput.val(),endDate=endDateInput.val(),startDateMoment=moment(startDate,daterangepicker_format),endDateMoment=moment(endDate,daterangepicker_format),startDateMoment.isValid()&&endDateMoment.isValid()&&(l.setStartDate(startDateMoment),l.setEndDate(endDateMoment))),"guests"==t&&(guests=p("guests"),guests||(guests=1),guests-=0,e.search_guest=guests),"room_types"==t&&e.room_type_reset(),"prices"==t&&e.price_reset(),"instant_book"==t&&(instant_book=p("instant_book"),e.instant_book=instant_book),"more_filters"==t&&(bathrooms=p("bathrooms"),beds=p("beds"),bedrooms=p("bedrooms"),e.search_bath=bathrooms-0,e.search_beds=beds-0,e.search_bedrooms=bedrooms-0,e.amenities_reset(),e.property_type_reset()),"filters"==t&&(bathrooms=p("bathrooms"),beds=p("beds"),bedrooms=p("bedrooms"),instant_book=p("instant_book"),e.search_bath=bathrooms-0,e.search_beds=beds-0,e.search_bedrooms=bedrooms-0,e.instant_book=instant_book,e.price_reset(),e.room_type_reset(),e.amenities_reset(),e.property_type_reset()),e.opened_filter="",e.update_filter_status(),e.$$phase||e.$apply()},e.reset_filters("dates"),e.price_reset=function(){var e=p("min_price"),t=p("max_price");document.getElementById("slider").noUiSlider.set([e-0,t-0]),document.getElementById("mobslider").noUiSlider.set([e-0,t-0])},e.room_type_reset=function(){room_types=p("room_type"),room_types_array=room_types.split(","),$(".room-type").prop("checked",!1),$.each(room_types_array,function(e,t){$("#room_type_"+t).prop("checked",!0),$("#mob_room_type_"+t).prop("checked",!0)})},e.property_type_reset=function(){property_type=p("property_type"),property_type_array=property_type.split(","),$(".property_type").prop("checked",!1),$.each(property_type_array,function(e,t){$("#property_"+t).prop("checked",!0),$("#mob_property_"+t).prop("checked",!0)})},e.amenities_reset=function(){amenities=p("amenities"),amenities_array=amenities.split(","),$(".amenities").prop("checked",!1),$.each(amenities_array,function(e,t){$("#amenities_"+t).prop("checked",!0),$("#mob_amenities_"+t).prop("checked",!0)})};var _=e.locationViewport=JSON.parse($("#viewport").val()),h="",u="",g="",f="",v=new InfoBubble({maxWidth:3e3});angular.forEach(_,function(e,t){h=_.southwest.lat,u=_.southwest.lng,g=_.northeast.lat,f=_.northeast.lng});var k=new google.maps.LatLngBounds(new google.maps.LatLng(h,u),new google.maps.LatLng(g,f));e.viewport=e.locationViewport=k,setTimeout(function(){autocomplete=new google.maps.places.Autocomplete(document.getElementById("header-search-form"),{types:["geocode"]}),google.maps.event.addListener(autocomplete,"place_changed",function(){var t=$("#header-search-form").val(),a=t.replace(" ","+");m("location",a);var i=autocomplete.getPlace(),o=i.geometry.location.lat(),r=i.geometry.location.lng();i&&i.geometry&&i.geometry.viewport&&(e.viewport=e.locationViewport=i.geometry.viewport),e.cLat=e.locationLat=o,e.cLong=e.locationLong=r,e.map_lat_long="",search_on_map="",$(".search_new_header").show(),e.search_result(),x()}),sm_autocomplete1=new google.maps.places.Autocomplete(document.getElementById("header-search-form-mob"),{types:["geocode"]}),google.maps.event.addListener(sm_autocomplete1,"place_changed",function(){$("#header-search-form").val($("#header-search-form-mob").val());var t=$("#header-search-form-mob").val(),a=t.replace(" ","+"),i=sm_autocomplete1.getPlace();if(!i.geometry)return!1;var o=i.geometry.location.lat(),r=i.geometry.location.lng();i&&i.geometry&&i.geometry.viewport&&(e.viewport=e.locationViewport=i.geometry.viewport),e.cLat=e.locationLat=o,e.cLong=e.locationLong=r,e.map_lat_long="",search_on_map="",m("location",a),e.apply_filters("location_refinement")}),e.map_lat_long=""},1e3),$(document).on("click",".header_refinement",function(){var e=$(this).attr("data");$(".header_refinement_input").val(e),$(".header_refinement").removeClass("active"),$(this).addClass("active"),$(".search_new_header").hide(),$(this).hasClass("in_form")||(window.location=APP_URL+"/s?location="+p("location")+"&checkin="+p("checkin")+"&checkout="+p("checkout")+"&guests="+p("guests")+"&current_refinement="+e)}),$(document).on("click",".header_refinement_modal",function(){current_refinement=$(this).attr("data"),$(".header_refinement_modal_input").val(current_refinement),$(".header_refinement_modal").removeClass("active"),$(this).addClass("active"),e.apply_filters("location_refinement")}),e.zoom="",e.cLat="",e.cLong="",e.locationLat="",e.locationLong="";var b,w="",y=[];new google.maps.InfoWindow({content:w});function x(t){if(t||(t=""),""==e.zoom)var a=10;else a=e.zoom;if(0==$("#lat").val())a=1;if(""==e.cLat&&""==e.cLong)var i=$("#lat").val(),o=$("#long").val();else i=e.cLat,o=e.cLong;var r={scrollwheel:!1,center:new google.maps.LatLng(i,o),zoom:a,minZoom:2,maxZoom:18,zoomControl:!0,zoomControlOptions:{position:google.maps.ControlPosition.LEFT_TOP,style:google.maps.ZoomControlStyle.SMALL},mapTypeControl:!1,streetViewControl:!1,navigationControl:!1,backgroundColor:"#a4ddf5",styles:[{featureType:"water",elementType:"geometry",stylers:[{color:"#a4ddf5"}]}]};b=new google.maps.Map(document.getElementById("map_canvas"),r),0!=i&&0!=o&&b.fitBounds(e.viewport),google.maps.event.addListener(b,"idle",function(){e.map_fit_bounds="",e.zoom=b.getZoom();var t=b.getZoom(),a=b.getBounds(),i=a.getSouthWest().lat(),o=a.getSouthWest().lng(),r=a.getNorthEast().lat(),s=a.getNorthEast().lng(),n=a.getCenter().lat(),l=a.getCenter().lng();e.cLat=a.getCenter().lat(),e.cLong=a.getCenter().lng(),map_display=$(".map").css("display"),"none"!=map_display?e.map_lat_long=t+"~"+a+"~"+i+"~"+o+"~"+r+"~"+s+"~"+n+"~"+l:e.map_lat_long="";var c="";$(".map-auto-refresh-checkbox:checked").each(function(e){c=$(this).val()}),"true"==c||($(".map-auto-refresh").addClass("hide"),$(".map-manual-refresh").removeClass("hide"))});var s,n=document.createElement("div");new C(n,b);b.controls[google.maps.ControlPosition.LEFT_TOP].push(n),google.maps.event.addListener(b,"dragend",function(){search_on_map="Yes",v.isOpen()&&(v.close(),v=new InfoBubble({maxWidth:3e3})),e.zoom=b.getZoom();var t=b.getZoom(),a=b.getBounds(),i=a.getSouthWest().lat(),o=a.getSouthWest().lng(),r=a.getNorthEast().lat(),s=a.getNorthEast().lng(),n=a.getCenter().lat(),l=a.getCenter().lng();e.cLat=a.getCenter().lat(),e.cLong=a.getCenter().lng();var c=t+"~"+a+"~"+i+"~"+o+"~"+r+"~"+s+"~"+n+"~"+l;e.map_lat_long=c;var d="";$(".map-auto-refresh-checkbox:checked").each(function(e){d=$(this).val()}),"true"==d?e.search_result():($(".map-auto-refresh").addClass("hide"),$(".map-manual-refresh").removeClass("hide"))}),e.infowindow="",s=google.maps.InfoWindow.prototype.set,google.maps.InfoWindow.prototype.set=function(t,a){"map"===t&&(this.get("noSupress")||(e.infowindow=this)),s.apply(this,arguments)},google.maps.event.addListener(b,"click",function(){e.marker_click>0&&(e.marker_click=0),v.isOpen()&&(v.close(),v=new InfoBubble({maxWidth:3e3})),""!=e.infowindow&&e.infowindow.close()}),google.maps.event.addListenerOnce(b,"mousemove",function(){google.maps.event.addListener(b,"zoom_changed",function(){search_on_map="Yes",v.isOpen()&&(v.close(),v=new InfoBubble({maxWidth:3e3})),e.zoom=b.getZoom();var t=b.getZoom(),a=b.getBounds(),i=a.getSouthWest().lat(),o=a.getSouthWest().lng(),r=a.getNorthEast().lat(),s=a.getNorthEast().lng(),n=a.getCenter().lat(),l=a.getCenter().lng();e.cLat=a.getCenter().lat(),e.cLong=a.getCenter().lng();var c=t+"~"+a+"~"+i+"~"+o+"~"+r+"~"+s+"~"+n+"~"+l;e.map_lat_long=c;var d="";$(".map-auto-refresh-checkbox:checked").each(function(e){d=$(this).val()}),"true"==d?e.search_result():($(".map-auto-refresh").addClass("hide"),$(".map-manual-refresh").removeClass("hide"))})})}function C(e,t){var a=document.createElement("div");a.style.position="relative",a.style.padding="5px",a.style.margin="-65px 0px 0px 50px",a.style.fontSize="14px",a.innerHTML='<div class="map-refresh-controls google"><a   class="map-manual-refresh btn btn-primary  hide" style="background-color:#ff5a5f;color: #ffffff;">'+$("#redo_search_value").val()+' <i class="icon icon-refresh icon-space-left"></i></a><div class="panel map-auto-refresh"><label class="checkbox"><input type="checkbox" checked="checked" name="redo_search" value="true" class="map-auto-refresh-checkbox"><small>'+$("#current_language").val()+"</small></label></div></div>",e.appendChild(a),google.maps.event.addDomListener(a,"click",function(){})}function D(e,t,a,i){this.pos=e,this.txt_=t,this.cls_=a,this.map_=i,this.div_=null,this.setMap(i)}function L(e){var t="";return"hover"==e&&(t=""),new google.maps.MarkerImage("images/"+t,new google.maps.Size(50,50),new google.maps.Point(0,0),new google.maps.Point(9,20))}$(document).ready(function(){e.search_result()}),D.prototype=new google.maps.OverlayView,D.prototype.onAdd=function(){var e=document.createElement("DIV");e.className=this.cls_,e.innerHTML=this.txt_,this.div_=e;var t=this.getProjection().fromLatLngToDivPixel(this.pos);e.style.left=t.x-25+"px",e.style.top=t.y-25+"px",this.getPanes().overlayMouseTarget.appendChild(e);var a=this;google.maps.event.addDomListener(e,"click",function(e){google.maps.event.trigger(a,"click"),e.stopPropagation()}),google.maps.event.addDomListener(e,"touchstart",function(e){google.maps.event.trigger(a,"click"),e.stopPropagation()}),google.maps.event.addDomListener(e,"dblclick",function(e){e.stopPropagation()})},D.prototype.draw=function(){var e=this.getProjection().fromLatLngToDivPixel(this.pos),t=this.div_;t.style.left=e.x-25+"px",t.style.top=e.y-25+"px",t.style.position="absolute",t.style.cursor="pointer"},D.prototype.onRemove=function(){this.div_.parentNode.removeChild(this.div_),this.div_=null},D.prototype.hide=function(){this.div_&&(this.div_.style.visibility="hidden")},D.prototype.show=function(){this.div_&&(this.div_.style.visibility="visible")},D.prototype.toggle=function(){this.div_&&("hidden"==this.div_.style.visibility?this.show():this.hide())},D.prototype.toggleDOM=function(){this.getMap()?this.setMap(null):this.setMap(this.map_)},$(".footer-toggle").click(function(){$(".footer-container").slideToggle("fast",function(){$(".footer-container").is(":visible")?($(".open-content").hide(),$(".close-content").show()):($(".open-content").show(),$(".close-content").hide())})}),$(document).on("click",".map-manual-refresh",function(){$(".map-manual-refresh").addClass("hide"),$(".map-auto-refresh").removeClass("hide"),e.search_result()}),$(document).on("click",".rooms-slider",function(){var e=$(this).attr("data-room_id"),a=$("#rooms_image_"+e).attr("rooms_image"),i=$("#rooms_image_"+e).attr("src");if(""==$.trim(a))t.post("rooms_photos",{rooms_id:e}).then(function(t){angular.forEach(t.data,function(e){a=""==$.trim(a)?e.name:a+"^>"+e.name}),$("#rooms_image_"+e).attr("rooms_image",a);var o=a.split("^>"),r=o.length,s=0,n="";if(angular.forEach(o,function(e){$.trim(e)==$.trim(i)&&(n=s),s++}),1==$(this).is(".target-prev"))var l=n-1,c=r-1;else l=n+1,c=0;if(void 0!==o[l]&&"null"!=$.trim(o[l]))var d=o[l];else d=o[c];var m=d;$("#rooms_image_"+e).attr("src",m)});else{$(this).parent().addClass("loading");var o=a.split("^>"),r=o.length,s=0,n="";if(angular.forEach(o,function(e){$.trim(e)==$.trim(i)&&(n=s),s++}),1==$(this).is(".target-prev"))var l=n-1,c=r-1;else l=n+1,c=0;if(void 0!==o[l]&&"null"!=$.trim(o[l]))var d=o[l];else d=o[c];var m=d;$(".panel-image").removeClass("loading"),$("#rooms_image_"+e).attr("src",m)}}),e.marker_slider=function(e){e.stopPropagation();angular.element(e.currentTarget);var a=$(e.currentTarget).attr("data-room_id"),i=$("#marker_image_"+a).attr("rooms_image"),o=$("#marker_image_"+a).attr("src");if(""==$.trim(i))t.post("rooms_photos",{rooms_id:a}).then(function(t){angular.forEach(t.data,function(e){i=""==$.trim(i)?e.name:i+"^>"+e.name}),$("#marker_image_"+a).attr("rooms_image",i);var r=i.split("^>"),s=r.length,n=0,l="";if(angular.forEach(r,function(e){$.trim(e)==$.trim(o)&&(l=n),n++}),1==$(e.currentTarget).is(".target-prev"))var c=l-1,d=s-1;else c=l+1,d=0;if(void 0!==r[c]&&"null"!=$.trim(r[c]))var m=r[c];else m=r[d];var p=m;$("#marker_image_"+a).attr("src",p)});else{$(e.currentTarget).parent().addClass("loading");var r=i.split("^>"),s=r.length,n=0,l="";if(angular.forEach(r,function(e){$.trim(e)==$.trim(o)&&(l=n),n++}),1==$(e.currentTarget).is(".target-prev"))var c=l-1,d=s-1;else c=l+1,d=0;if(void 0!==r[c]&&"null"!=$.trim(r[c]))var m=r[c];else m=r[d];var p=m;$(".panel-image").removeClass("loading"),console.log(p,a),$(".marker_image_"+a).attr("src",p)}};var I=p("min_price"),P=p("max_price"),E=p("room_type"),M=p("property_type"),A=p("amenities"),B=p("checkin"),S=p("checkout"),T=p("guests"),O=p("beds"),R=p("bathrooms"),U=p("bedrooms");$(document).ready(function(){$("#checkin,#checkout,#slider").click(function(){$(window).width()<760&&(""!=I||""!=P||""!=E||""!=M||""!=A||""!=B||""!=S||""!=T||""!=O||""!=R||""!=U?$("#more_filter_submit").removeAttr("disabled"):$("#more_filter_submit").attr("disabled","disabled"))})}),$(document).on("change","#room-options,#instant_book,#min_max_pricerange,#guest-select",function(){$(window).width()<760&&(""!=I||""!=P||""!=E||""!=M||""!=A||""!=B||""!=S||""!=T||""!=O||""!=R||""!=U?$("#more_filter_submit").removeAttr("disabled"):$("#more_filter_submit").attr("disabled","disabled"))}),$(document).on("change",'[id^="map-search"]',function(){var e=p("amenities"),t=p("property_type"),a=0;$('[id^="map-search"]').each(function(){$(this).is(":checkbox")?$(this).is(":checked")?a++:""==e&&""==t||a++:""!=$(this).val()&&a++}),0==a?$(window).width()<760?$("#more_filter_submit").removeAttr("disabled"):$("#more_filter_submit").attr("disabled","disabled"):$("#more_filter_submit").removeAttr("disabled")}),$(document).on("click","#cancel-filter",function(){var t=prop_app_fil.split(","),a=amen_app_fil.split(",");$('[id^="map-search"]').each(function(){$(this).is(":checkbox")?$(window).width()>760&&("-1"!=jQuery.inArray($(this).val(),t)&&$(this).hasClass("property_type")||"-1"!=jQuery.inArray($(this).val(),a)&&$(this).hasClass("amenities")?$(this).prop("checked",!0):$(this).prop("checked",!1)):$(window).width()>760&&$(this).val("")}),$(window).width()>760&&($("#map-search-min-bedrooms").val(broom_app_fil),$("#map-search-min-bathrooms").val(bath_app_fil),$("#map-search-min-beds").val(bed_app_fil)),$("#more_filter_submit").attr("disabled","disabled"),$(".toggle-hide").css("display","block"),$(".toggle-group").css("display","none"),$(".filter-div").hide(),$(".button_ipunk").show(),$(".button_ipunk4").show(),$(".sidebar").css("height","100%"),e.search_result()})}]),$(".show-filters").click(function(){$(".sidebar").addClass("fixed-hieght")}),$("#cancel-filter").click(function(){$(".sidebar").removeClass("fixed-hieght")}),$("#more_filter_submit").click(function(){$(window).width()<480&&($(".filter-div").hide(),$(".button_ipunk").show(),$(".button_ipunk4").show())});