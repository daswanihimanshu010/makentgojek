var daterangepicker_format=$('meta[name="daterangepicker_format"]').attr("content"),datepicker_format=$('meta[name="datepicker_format"]').attr("content");app.directive("postsPagination",function(){return{restrict:"E",template:'<ul class="pagination"><li ng-show="currentPage != 1"><a href="javascript:void(0)" ng-click="messages_result(1)">&laquo;</a></li><li ng-show="currentPage != 1"><a href="javascript:void(0)" ng-click="messages_result(currentPage-1)">&lsaquo; '+$("#pagin_prev").val()+' </a></li><li ng-repeat="i in range" ng-class="{active : currentPage == i}"><a href="javascript:void(0)" ng-click="messages_result(i)">{{i}}</a></li><li ng-show="currentPage != totalPages"><a href="javascript:void(0)" ng-click="messages_result(currentPage+1)"> '+$("#pagin_next").val()+' &rsaquo;</a></li><li ng-show="currentPage != totalPages"><a href="javascript:void(0)" ng-click="messages_result(totalPages)">&raquo;</a></li></ul>'}}).controller("inbox",["$scope","$http","$rootScope",function(a,e,t){a.today=new Date,setTimeout(function(){a.totalPages=0,a.currentPage=1,a.range=[],pageNumber=1,void 0===pageNumber&&(pageNumber="1");var n=$("#inbox_filter_select").val(),i=a.user_id;e.post("inbox/message_by_type",{data:i,type:n}).then(function(e){a.message_result=e.data,a.totalPages=e.data.last_page,a.currentPage=e.data.current_page;for(var t=[],n=1;n<=e.data.last_page;n++)t.push(n);a.range=t}),e.post("inbox/message_count",{data:i,type:n}).then(function(e){a.message_count=e.data}),a.messages_result=function(t){void 0===t&&(t="1");var n=$("#inbox_filter_select").val(),i=a.user_id;e.post("inbox/message_by_type?page="+t,{data:i,type:n}).then(function(e){a.message_result=e.data,a.totalPages=e.data.last_page,a.currentPage=e.data.current_page;for(var t=[],n=1;n<=e.data.last_page;n++)t.push(n);a.range=t})},a.archive=function(n,i,r,s){var o=a.user_id;e.post("inbox/archive",{id:i,msg_id:r,type:s}).then(function(i){"Archive"==s&&(a.message_result.data[n].archive=1),"Unarchive"==s&&(a.message_result.data[n].archive=0),e.post("inbox/message_count",{data:o,type:s}).then(function(n){a.message_count=n.data,t.inbox_count=n.data.unread_count;var i=$("#inbox_filter_select").val(),r=a.user_id,s=a.currentPage;e.post("inbox/message_by_type?page="+s,{data:r,type:i}).then(function(e){a.message_result=e.data,a.type=i,a.totalPages=e.data.last_page,a.currentPage=e.data.current_page;for(var t=[],n=1;n<=e.data.last_page;n++)t.push(n);a.range=t})})})},a.star=function(n,r,s,o){e.post("inbox/star",{id:r,msg_id:s,type:o}).then(function(r){"Star"==o&&(a.message_result.data[n].star=1),"Unstar"==o&&(a.message_result.data[n].star=0),e.post("inbox/message_count",{data:i,type:o}).then(function(e){a.message_count=e.data,t.inbox_count=e.data.unread_count,a.messages_result(a.currentPage)})})},$("#inbox_filter_select").change(function(){var t=this.value,n=a.user_id;e.post("inbox/message_by_type",{data:n,type:t}).then(function(i){a.message_result=i.data,a.type=t,a.totalPages=i.data.last_page,a.currentPage=i.data.current_page;for(var r=[],s=1;s<=i.data.last_page;s++)r.push(s);a.range=r,e.post("inbox/message_count",{data:n,type:t}).then(function(e){a.message_count=e.data})})})},10)}]),app.controller("conversation",["$scope","$http",function(a,e){function t(e,t,i){i&&($("#pricing_start_date").datepicker("destroy"),$("#pricing_end_date").datepicker("destroy")),$("#pricing_start_date").datepicker({minDate:0,dateFormat:datepicker_format,beforeShowDay:function(a){a=jQuery.datepicker.formatDate("yy-mm-dd",a);return-1!=$.inArray(a,t)?[!1]:[!0]},onSelect:function(a,e){var t=e.selectedMonth+1,i=e.selectedDay+"-"+t+"-"+e.selectedYear;$('input[name="pricing[start_date]"]').val(i),(s=$("#pricing_start_date").datepicker("getDate")).setDate(s.getDate()+1),$("#pricing_end_date").datepicker("option","minDate",s),$("#pricing_end_date").datepicker("setDate",s);var r=s.getDate()+"-"+(s.getMonth()+1)+"-"+s.getFullYear();$('input[name="pricing[end_date]"]').val(r),setTimeout(function(){$("#pricing_end_date").datepicker("show")},20);var s,o=$('input[name="pricing[start_date]"]').val();n(s=$('input[name="pricing[end_date]"]').val(),o,$("#pricing_guests").val(),$("#pricing_room_id").val()),a!=new Date&&$(".ui-datepicker-today").removeClass("ui-datepicker-today")}}),jQuery("#pricing_end_date").datepicker({minDate:1,dateFormat:datepicker_format,beforeShowDay:function(a){var e=moment(a).subtract(1,"d");a=jQuery.datepicker.formatDate("yy-mm-dd",e.toDate());return-1!=$.inArray(a,t)?[!1]:[!0]},onSelect:function(a,e){var t=e.selectedMonth+1,i=e.selectedDay+"-"+t+"-"+e.selectedYear;$('input[name="pricing[end_date]"]').val(i);var r=$("#pricing_start_date").datepicker("getDate");if((o=$("#pricing_end_date").datepicker("getDate"))<=r&&""!=$("#pricing_start_date").val()){var s=$("#pricing_end_date").datepicker("option","minDate");$("#pricing_end_date").datepicker("setDate",s)}r=$('input[name="pricing[start_date]"]').val();var o=$('input[name="pricing[end_date]"]').val(),d=$("#pricing_guests").val(),c=$("#pricing_room_id").val();""!=r&&n(o,r,d,c)}}),$("#pricing_guests").val()>a.accomodates&&$("#pricing_guests option[value=1]").prop("selected",!0)}function n(a,t,n,i){$(".special-offer-date-fields").addClass("loading"),e.post("../../rooms/price_calculation",{checkin:t,checkout:a,guest_count:n,room_id:i}).then(function(a){$(".special-offer-date-fields").removeClass("loading"),"Not available"==a.data.status?(""!=a.data.error?($("#availability_warning #error").text(a.data.error),$("#availability_warning #not_available").addClass("hide"),$("#availability_warning #error").removeClass("hide")):($("#availability_warning #error").addClass("hide"),$("#availability_warning #error").text(""),$("#availability_warning #not_available").removeClass("hide")),$("#availability_warning").removeClass("hide")):$("#availability_warning").addClass("hide"),$("#pricing_price").val(a.data.subtotal),$("#availability_status").val(a.data.status)})}a.calculation_status="",a.range=function(a,e){for(var t=[],n=a;n<=e;n++)t.push(n);return t},a.reply_message=function(a){var t=$('[data-key="'+a+'"] textarea[name="message"]').val(),n=$('[data-key="'+a+'"] input[name="template"]').val();if(2==n){if(""==$("#pricing_start_date").val()||""==$("#pricing_end_date").val())return $("#availability_warning").removeClass("hide"),"";if(""==$("#pricing_price").val())return $("#availability_warning1").removeClass("hide"),"";$("#availability_warning").addClass("hide"),$("#availability_warning1").addClass("hide")}e.post(APP_URL+"/messaging/qt_reply/"+$("#reservation_id").val(),{message:t,template:n,pricing_room_id:$("#pricing_room_id").val(),pricing_checkin:$("#pricing_start_date").val(),pricing_checkout:$("#pricing_end_date").val(),pricing_guests:$("#pricing_guests").val(),pricing_price:$("#pricing_price").val()}).then(function(e){"false"!=e.data.success?($("#thread-list").prepend(e.data),$('[data-key="'+a+'"] textarea[name="message"]').val(""),$(".inquiry-form-fields").addClass("hide"),$('[data-tracking-section="accept"] ul').addClass("hide"),$('[data-tracking-section="decline"] ul').addClass("hide"),$('[data-tracking-section="discussion"] ul').addClass("hide")):$('[data-error="price"]').html(e.data.msg)})},$(document).on("change","#month-dropdown",function(){var a=$(this).val(),t=a.split("-")[0],n=a.split("-")[1],i={};i.month=n,i.year=t,i.reservation_id=$("#reservation_id").val(),i.room_id=$("#hosting").val();var r=JSON.stringify(i);return $("#calendar-container").addClass("loading"),e.post(APP_URL+"/inbox/calendar",{data:r}).then(function(a){$("#calendar-container").removeClass("loading"),$("#calendar-container").html(a.data)}),!1}),$(document).on("click",".nextMonth, .previousMonth",function(){var a=$(this).attr("data-month"),t=$(this).attr("data-year"),n={};n.month=a,n.year=t,n.reservation_id=$("#reservation_id").val(),n.room_id=$("#hosting").val();var i=JSON.stringify(n);return $("#calendar-container").addClass("loading"),e.post(APP_URL+"/inbox/calendar",{data:i}).then(function(a){$("#calendar-container").removeClass("loading"),$("#calendar-container").html(a.data)}),!1}),$(document).on("click","#hosting",function(){var a={},t=$("#month-dropdown").val(),n=t.split("-")[0],i=t.split("-")[1];a.month=i,a.year=n,a.reservation_id=$("#reservation_id").val(),a.room_id=$(this).val();var r=JSON.stringify(a);return $("#calendar-container").addClass("loading"),e.post(APP_URL+"/inbox/calendar",{data:r}).then(function(a){$("#calendar-container").removeClass("loading"),$("#calendar-container").html(a.data)}),list_type=$("#edit_calendar_url").attr("data-type"),"Experiences"==list_type?$("#edit_calendar_url").attr("href",APP_URL+"/host/manage_experience/"+$(this).val()+"?step_num=1"):$("#edit_calendar_url").attr("href",APP_URL+"/manage-listing/"+$(this).val()+"/calendar"),!1}),$("#month-dropdown").val($("#month-dropdown_value").val()),$("#hosting").val($("#room_id").val()),$(document).on("click",".offer_attach",function(){$(".inquiry-form-fields").removeClass("hide"),$('[data-tracking-section="accept"] ul').removeClass("hide"),$('[data-tracking-section="accept"] input[name="template"][value=2]').prop("checked",!0);var a=$('[data-tracking-section="accept"] input[name="template"]:checked').parent().parent().parent().parent().data("key");$('[data-key="'+a+'"] .drawer').removeClass("hide")}),$(document).on("click",".pre_approve",function(){$(".inquiry-form-fields").removeClass("hide"),$('[data-tracking-section="accept"] ul').removeClass("hide"),$('[data-tracking-section="accept"] input[name="template"][value=1]').prop("checked",!0);var a=$('[data-tracking-section="accept"] input[name="template"]:checked').parent().parent().parent().parent().data("key");$('[data-key="'+a+'"] .drawer').removeClass("hide")}),$(document).on("click",".option-list a",function(){var a=$(this).parent().data("tracking-section");$("[data-tracking-section] ul").addClass("hide"),$('[data-tracking-section="'+a+'"] ul').removeClass("hide");var e=$('[data-tracking-section="'+a+'"] input[name="template"]:checked').parent().parent().parent().parent().data("key");$('[data-key="'+e+'"] .drawer').removeClass("hide")}),$(document).on("click",'input[name="template"]',function(){$("[data-key] .drawer").addClass("hide");var a=$(this).parent().parent().parent().parent().data("key");$('[data-key="'+a+'"] .drawer').removeClass("hide")}),setTimeout(function(){var i=$("#pricing_room_id").val();e.post("../../rooms/rooms_calendar",{data:i}).then(function(i){t(i.data.changed_price,i.data.not_avilable,!1),a.accomodates=i.data.room_accomodates,$("#pricing_room_id").change(function(){var i,r=$(this).val();""!=r&&(i=r,$(".special-offer-date-fields").addClass("loading"),e.post("../../rooms/rooms_calendar",{data:i}).then(function(e){t(e.data.changed_price,e.data.not_avilable,!0),a.accomodates=e.data.room_accomodates,$(".special-offer-date-fields").removeClass("loading");var i=$('input[name="pricing[start_date]"]').val(),r=$('input[name="pricing[end_date]"]').val(),s=$("#pricing_guests").val(),o=$("#pricing_room_id").val();""!=i&&""!=r&&n(r,i,s,o)}))}),$("#pricing_guests").change(function(){var a=$('input[name="pricing[start_date]"]').val(),e=$('input[name="pricing[end_date]"]').val(),t=$("#pricing_guests").val(),i=$("#pricing_room_id").val();""!=a&&""!=e?n(e,a,t,i):$("#pricing_start_date").trigger("select")})})},10)}]),$(document).on("contextmenu",'a[data-method="post"]',function(){return!1}),$(document).on("click",'a[data-method="post"]',function(){$('a[data-method="post"]').attr("disabled","disabled")});