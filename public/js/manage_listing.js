app.controller("manage_listing",["$scope","$http","$compile","$filter",function($scope,$http,$compile,$filter){var autocomplete,map,geocoder;function initAutocomplete(){var e=window.location.href.split("/");"location"==$(e).get(-1)&&(autocomplete=new google.maps.places.Autocomplete(document.getElementById("address_line_1"),{types:["geocode"]})).addListener("place_changed",fillInAddress)}function fillInAddress(){$scope.autocomplete_used=!0,fetchMapAddress(autocomplete.getPlace())}function initMap(){geocoder=new google.maps.Geocoder,map=new google.maps.Map(document.getElementById("map"),{center:{lat:parseFloat($scope.latitude),lng:parseFloat($scope.longitude)},zoom:15,mapTypeId:google.maps.MapTypeId.ROADMAP,disableDefaultUI:!0,zoomControl:!0,zoomControlOptions:{style:google.maps.ZoomControlStyle.SMALL}}),$("<div/>").addClass("verify-map-pin").appendTo(map.getDiv()).click(function(){}),map.addListener("dragend",function(){geocoder.geocode({latLng:map.getCenter()},function(e,t){t==google.maps.GeocoderStatus.OK&&e[0]&&(fetchMapAddress(e[0],map.getCenter()),$("#js-next-btn3").prop("disabled",!1))}),$(".verify-map-pin").removeClass("moving"),$(".verify-map-pin").addClass("unset")}),map.addListener("zoom_changed",function(){geocoder.geocode({latLng:map.getCenter()},function(e,t){t==google.maps.GeocoderStatus.OK&&e[0]&&fetchMapAddress(e[0],map.getCenter())})}),map.addListener("drag",function(){$(".verify-map-pin").removeClass("unset"),$(".verify-map-pin").addClass("moving")})}function fetchMapAddress(e,t=""){"street_address"==e.types&&($scope.location_found=!0);var a={street_number:"short_name",route:"long_name",sublocality_level_1:"long_name",sublocality:"long_name",locality:"long_name",administrative_area_level_1:"long_name",country:"short_name",postal_code:"short_name"};$("#city").val(""),$("#state").val(""),$("#country").val(""),$("#address_line_1").val(""),$("#address_line_2").val(""),$("#postal_code").val("");var s=e;$scope.street_number="";for(var i=0;i<s.address_components.length;i++){var o=s.address_components[i].types[0];if(a[o]){var n=s.address_components[i][a[o]];if("street_number"==o&&($scope.street_number=n),"route"==o){var d=$scope.street_number+" "+n;$("#address_line_1").val($.trim(d))}"postal_code"==o&&$("#postal_code").val(n),"locality"==o&&$("#city").val(n),"administrative_area_level_1"==o&&$("#state").val(n),"country"==o&&$("#country").val(n)}}$("#address_line_1").val();var r=s.geometry.location.lat(),l=s.geometry.location.lng();""==$("#state").val()||""==$("#city").val()?$("#js-next-btn").prop("disabled",!0):$("#js-next-btn").prop("disabled",!1),""!=t?($scope.latitude=t.lat(),$scope.longitude=t.lng()):($scope.latitude=r,$scope.longitude=l)}function upload(){upload2(),$(document).on("change","#upload_photos",function(){$("#js-photo-grid").append('<li class="col-lg-4 col-md-6 row-space-4"><div class=" photo-item"><div class=="photo-size photo-drag-target js-photo-link"></div></div></li>');$("#js-photo-grid li").last().append('<div class="" id="js-manage-listing-content-container"><div class="manage-listing-content-wrapper" style="height:100%;z-index:9;"><div class="manage-listing-content" id="js-manage-listing-content"><div><div class="row-space-top-6 basics-loading loading"></div></div></div></div></div>'),jQuery.ajaxFileUpload({url:"../../add_photos/"+$("#room_id").val(),secureuri:!1,fileElementId:"upload_photos",dataType:"json",async:!1,success:function(e){$("#js-photo-grid #js-manage-listing-content-container").remove(),$("#js-photo-grid li:last-child").remove(),e.error.error_title&&($("#js-error .panel-header").text(e.error.error_title),$("#js-error .panel-body").text(e.error.error_description),$(".js-delete-photo-confirm").addClass("hide"),$("#js-error").attr("aria-hidden",!1)),e.succresult&&""!=e.succresult&&($scope.$apply(function(){$scope.photos_list=e.succresult,$("#photo_count").css("display","block"),$("#steps_count").text(e.succresult[0].steps_count),$scope.steps_count=e.succresult[0].steps_count}),document.getElementById("upload_photos").value="")},error:function(e,t,a){"error"==t&&($("#js-photo-grid #js-manage-listing-content-container").remove(),$("#js-photo-grid li:last-child").remove(),$("#js-error .panel-header").text("Photo Error"),$("#js-error .panel-body").text("Error uploading image! Please try uploading a different image!!!"),$(".js-delete-photo-confirm").addClass("hide"),$("#js-error").attr("aria-hidden",!1))}})})}function upload2(){$(document).on("change","#upload_photos2",function(){$("#js-photo-grid").append('<div class="" id="js-manage-listing-content-container"><div class="manage-listing-content-wrapper" style="height:100%;z-index:9;"><div class="manage-listing-content" id="js-manage-listing-content"><div><div class="row-space-top-6 basics-loading loading"></div></div></div></div></div>'),jQuery.ajaxFileUpload({url:"../../add_photos/"+$("#room_id").val(),secureuri:!1,fileElementId:"upload_photos2",dataType:"json",async:!1,success:function(e){$("#js-photo-grid #js-manage-listing-content-container").remove(),e.error_title?($("#js-error .panel-header").text(e.error_title),$("#js-error .panel-body").text(e.error_description),$(".js-delete-photo-confirm").addClass("hide"),$("#js-error").attr("aria-hidden",!1)):($scope.$apply(function(){$scope.photos_list=e,$("#photo_count").css("display","block"),$("#steps_count").text(e[0].steps_count),$scope.steps_count=e[0].steps_count}),$("#upload_photos2").reset()),upload2()}})})}function photos_list(){$http.get("photos_list",{}).then(function(e){$scope.photos_list=e.data,e.data.length>0&&$("#photo_count").css("display","block")})}$scope.text_length_calc=function(e){return tag_free_text=e?String(e).replace(/<[^>]+>/gm,""):"",tag_free_text.length},$(document).on("click","#add_language",function(){$("#add_language_des").show(),$(".description_form").hide(),$(".tab-item").attr("aria-selected","false"),$("#write-description-button").prop("disabled",!0),$http.post("get_all_language",{}).then(function(e){$scope.all_language=e.data})}),$(document).on("click","#delete_language",function(){var e=$("#current_tab_code").val();$http.post("delete_language",{current_tab:e}).then(function(t){$http.post("lan_description",{}).then(function(t){$scope.lan_description=t.data,e=$("#current_tab_code").val("en")}),$scope.getdescription("en")})}),$(document).on("change","#language-select",function(){$("#write-description-button").prop("disabled",!1)}),$http.post("lan_description",{}).then(function(e){$scope.lan_description=e.data}),$http.post("get_all_language",{}).then(function(e){$scope.all_language=e.data}),$http.post("get_description",{lan_code:"en"}).then(function(e){$scope.name=e.data[0].name,$scope.summary=e.data[0].summary,$scope.space=e.data[0].rooms_description.space,$scope.access=e.data[0].rooms_description.access,$scope.interaction=e.data[0].rooms_description.interaction,$scope.notes=e.data[0].rooms_description.notes,$scope.house_rules=e.data[0].rooms_description.house_rules,$scope.neighborhood_overview=e.data[0].rooms_description.neighborhood_overview,$scope.transit=e.data[0].rooms_description.transit}),$scope.getdescription=function(e){e=e;$http.post("get_description",{lan_code:e}).then(function(t){if("en"!=e?($scope.name=t.data[0].name,$scope.summary=t.data[0].summary,$scope.space=t.data[0].space,$scope.access=t.data[0].access,$scope.interaction=t.data[0].interaction,$scope.notes=t.data[0].notes,$scope.house_rules=t.data[0].house_rules,$scope.neighborhood_overview=t.data[0].neighborhood_overview,$scope.transit=t.data[0].transit):($scope.name=t.data[0].name,$scope.summary=t.data[0].summary,$scope.space=t.data[0].rooms_description.space,$scope.access=t.data[0].rooms_description.access,$scope.interaction=t.data[0].rooms_description.interaction,$scope.notes=t.data[0].rooms_description.notes,$scope.house_rules=t.data[0].rooms_description.house_rules,$scope.neighborhood_overview=t.data[0].rooms_description.neighborhood_overview,$scope.transit=t.data[0].rooms_description.transit),t.data[0].lang_code){var a=$("#"+t.data[0].lang_code).attr("aria-selected");$("#current_tab_code").val(t.data[0].lang_code),$("#delete_language").show()}else{a=$("#en").attr("aria-selected");t.data[0].lang_code="en",$("#current_tab_code").val(t.data[0].lang_code),$("#delete_language").hide()}"false"==a&&($(".tab-item").attr("aria-selected","false"),$("#"+t.data[0].lang_code).attr("aria-selected","true")),$("#add_language_des").hide(),$(".description_form").show()})},$scope.addlanguageRow=function(){var e=$("#language-select").val();$("#current_tab_code").val(e),$http.post("add_description",{lan_code:e}).then(function(e){$scope.name=e.data[0].name,$scope.summary=e.data[0].summary,$scope.space=e.data[0].space,$scope.access=e.data[0].access,$scope.interaction=e.data[0].interaction,$scope.notes=e.data[0].notes,$scope.house_rules=e.data[0].house_rules,$scope.neighborhood_overview=e.data[0].neighborhood_overview,$scope.transit=e.data[0].transit,$("#write-description-button").prop("disabled",!0),$http.post("lan_description",{}).then(function(e){$scope.lan_description=e.data,$("#add_language_des").hide(),$(".description_form").show(),$(".multiple-description-tabs").show(),$("#delete_language").show();var t=e.data[0].lan_id-1;$(".tab-item").attr("aria-selected","false"),setTimeout(function(){$("#"+e.data[t].lan_code).attr("aria-selected","true")},100)}),$("#language-select").prop("selectedIndex",0)})},jQuery(document).ready(function(e){window.history&&e(window).on("popstate",function(){var t=window.location.href.split("/"),a=e(t).get(-1);e("#href_"+a).attr("href",window.location.href),e("#href_"+a).trigger("click")})}),$(document).on("click",'[data-track="welcome_modal_finish_listing"]',function(){var e={started:"Yes"},t=JSON.stringify(e);$http.post("update_rooms",{data:t}).then(function(e){$("body").removeClass("pos-fix3"),$(".welcome-new-host-modal").attr("aria-hidden","true")},function(e){"300"==e.status?window.location=APP_URL+"/login":"500"==e.status&&window.location.reload()})}),$(document).on("change",'[id^="basics-select-"], [id^="select-"]',function(){var e={};e[$(this).attr("name")]=$(this).val();var t=JSON.stringify(e),a=$(this).attr("data-saving");$("."+a+" h5").text("Saving..."),$("."+a).fadeIn(),$http.post("update_rooms",{data:t}).then(function(e){if("true"==e.data.success&&($("."+a+" h5").text("Saved!"),$("."+a).fadeOut(),$("#steps_count").text(e.data.steps_count),$scope.steps_count=e.data.steps_count),""!=e.data.redirect&&null!=e.data.redirect&&(window.location=e.data.redirect),""!=$scope.beds&&""!=$scope.bedrooms&&""!=$scope.bathrooms&&""!=$scope.bed_type){var t=a.substring(0,a.length-1);$('[data-track="'+t+'"] a div div .transition').removeClass("visible"),$('[data-track="'+t+'"] a div div .transition').addClass("hide"),$('[data-track="'+t+'"] a div div .pull-right .nav-icon').removeClass("hide")}},function(e){"300"==e.status?window.location=APP_URL+"/login":"500"==e.status&&window.location.reload()}),"beds"==$(this).attr("name")&&""!=$(this).val()&&$("#beds_show").show()}),$(document).on("blur","#video",function(){var e={};e[$(this).attr("name")]=$(this).val();var t=JSON.stringify(e);$("#video_error").fadeOut(),$(".saving-progress h5").text("Saving..."),$(".saving-progress").fadeIn(),$http.post("update_rooms",{data:t}).then(function(e){"true"==e.data.success?($(".saving-progress h5").text("Saved!"),$(".saving-progress").fadeOut(),$scope.video=e.data.video,$("#rooms_video_preview").parent().removeClass("hide"),$("#rooms_video_preview").attr("src",e.data.video)):($(".saving-progress").fadeOut(),$("#video_error").fadeIn())},function(e){"300"==e.status?window.location=APP_URL+"/login":"500"==e.status&&window.location.reload()})}),$(document).on("click","#remove_rooms_video",function(){$(this).attr("data-saving");$(".saving-progress h5").text("Removing..."),$(".saving-progress").fadeIn(),$http.post("remove_video").then(function(e){"true"==e.data.success&&(console.log(e.data),$(".saving-progress h5").text("Removed!"),$(".saving-progress").fadeOut(),$("#video").val(""),$("#rooms_video_preview").parent().addClass("hide"),$("#rooms_video_preview").attr("src",""),$scope.video=e.data.video)})}),$(document).on("blur",'[class^="overview-"]',function(){var e={};e[$(this).attr("name")]=$(this).val();var t=$("#current_tab_code").val(),a=JSON.stringify(e);""!=$(this).val()?($(".saving-progress h5").text("Saving..."),$(".saving-progress").fadeIn(),"en"==t&&($(".name_required_msg").addClass("hide"),$(".summary_required_msg").addClass("hide"),$(".name_required").removeClass("invalid"),$(".summary_required").removeClass("invalid")),$http.post("update_rooms",{data:a,current_tab:t}).then(function(e){"true"==e.data.success&&($(".saving-progress h5").text("Saved!"),$(".saving-progress").fadeOut(),$("#steps_count").text(e.data.steps_count),$scope.steps_count=e.data.steps_count),""!=$scope.name&&""!=$scope.summary&&"en"==t&&($('[data-track="description"] a div div .transition').removeClass("visible"),$('[data-track="description"] a div div .transition').addClass("hide"),$('[data-track="description"] a div div div .icon-ok-alt').removeClass("hide"))},function(e){"300"==e.status?window.location=APP_URL+"/login":"500"==e.status&&window.location.reload()})):("name"==$(this).attr("name")?$http.post("update_rooms",{data:a,current_tab:t}).then(function(e){"true"==e.data.success&&("en"==t&&($(".name_required").addClass("invalid"),$(".name_required_msg").removeClass("hide")),$("#steps_count").text(e.data.steps_count),$scope.steps_count=e.data.steps_count)},function(e){"300"==e.status?window.location=APP_URL+"/login":"500"==e.status&&window.location.reload()}):$http.post("update_rooms",{data:a,current_tab:t}).then(function(e){"true"==e.data.success&&("en"==t&&($(".summary_required").addClass("invalid"),$(".summary_required_msg").removeClass("hide")),$("#steps_count").text(e.data.steps_count),$scope.steps_count=e.data.steps_count)},function(e){"300"==e.status?window.location=APP_URL+"/login":"500"==e.status&&window.location.reload()}),"en"==t&&($('[data-track="description"] a div div .transition').removeClass("hide"),$('[data-track="description"] a div div .transition .icon').removeClass("hide"),$('[data-track="description"] a div div div .icon-ok-alt').addClass("hide"),$('[data-track="description"] a div div div .icon-ok-alt').removeClass("visible"))),"en"==t&&($scope.rooms_default_description.name=$scope.name,$scope.rooms_default_description.summary=$scope.summary)}),$(document).on("click","#js-write-more",function(){$(".write_more_p").hide(),$("#js-section-details").show(),$("#js-section-details_2").show()}),$(document).on("click",".nav-item a, .next_step a, #calendar_edit_cancel",function(){if(""!=$(this).attr("href")){$("#ajax_container").html('<div class="" id="js-manage-listing-content-container"><div class="manage-listing-content-wrapper" style="height:100%;"><div class="manage-listing-content" id="js-manage-listing-content"><div><div class="row-space-top-6 basics-loading loading"></div></div></div></div></div>'),$http.post($(this).attr("href").replace("manage-listing","ajax-manage-listing"),{data:{}}).then(function(e){if("false"==e.data.success_303)return window.location=APP_URL+"/login",!1;$("#ajax_container").html($compile(e.data)($scope)),$scope.name=$scope.rooms_default_description.name,$scope.summary=$scope.rooms_default_description.summary,$scope.notes=""},function(e){"300"==e.status&&(window.location=APP_URL+"/login")});var e=window.location.href.split("/"),t=$(e).get(-1);$("#href_"+t).attr("href",window.location.href);e=$(this).attr("href").split("/");var a=$(e).get(-1);return $scope.step=a,window.history.pushState({path:$(this).attr("href")},"",$(this).attr("href")),!1}}),$(document).on("click","#show_long_term",function(){$("#js-long-term-prices").removeClass("hide"),$("#js-set-long-term-prices").addClass("hide")}),$(document).on("click","#js-add-address, #js-edit-address",function(){var e={};$scope.autocomplete_used=!1,e.country=$scope.country,e.address_line_1=$scope.address_line_1,e.address_line_2=$scope.address_line_2,e.city=$scope.city,e.state=$scope.state,e.postal_code=$scope.postal_code,e.latitude=$scope.latitude,e.longitude=$scope.longitude;var t=JSON.stringify(e);$("#js-address-container").addClass("enter_address"),$("#address-flow-view .modal").fadeIn(),$("#address-flow-view .modal").attr("aria-hidden","false"),$http.post(window.location.href.replace("manage-listing","enter_address"),{data:t}).then(function(e){$("#js-address-container").html($compile(e.data)($scope)),initAutocomplete()})}),$(document).on("click","#js-next-btn",function(){var e={};if(e.country=$scope.country=$("#country").val(),e.address_line_1=$scope.address_line_1=$("#address_line_1").val(),e.address_line_2=$scope.address_line_2=$("#address_line_2").val(),e.city=$scope.city=$("#city").val(),e.state=$scope.state=$("#state").val(),e.postal_code=$scope.postal_code=$("#postal_code").val(),e.latitude=$scope.latitude,e.longitude=$scope.longitude,!e.country)return $("#location_country_field_error").removeClass("hide"),!1;$("#location_country_field_error").addClass("hide");var t=JSON.stringify(e);$scope.autocomplete_used||($scope.location_found=!0),$("#js-address-container .panel").addClass("loading");var a=new google.maps.Geocoder;address=$scope.address_line_1+", "+$scope.address_line_2+", "+$scope.city+", "+$scope.state+", "+$scope.country+", "+$scope.postal_code,a.geocode({address:address},function(e,a){a==google.maps.GeocoderStatus.OK&&($scope.latitude=e[0].geometry.location.lat(),$scope.longitude=e[0].geometry.location.lng(),result=e[0],"street_address"==result.types||"premise"==result.types?($scope.location_found=!0,$scope.autocomplete_used=!0):($scope.location_found=!1,$scope.autocomplete_used=!1)),$http.post(window.location.href.replace("manage-listing","location_not_found"),{data:t}).then(function(e){if("country_error"==e.data.status)return $("#location_country_field_error").removeClass("hide"),$("#js-address-container .panel").removeClass("loading"),!1;$("#js-address-container .panel").removeClass("loading"),$("#js-address-container").addClass("location_not_found"),$("#js-address-container").html($compile(e.data)($scope))})})}),$(document).on("click","#js-next-btn2",function(){var e={};e.country=$scope.country,e.address_line_1=$scope.address_line_1,e.address_line_2=$scope.address_line_2,e.city=$scope.city,e.state=$scope.state,e.postal_code=$scope.postal_code,e.latitude=$scope.latitude,e.longitude=$scope.longitude;var t=JSON.stringify(e);$("#js-address-container .panel").addClass("loading"),$http.post(window.location.href.replace("manage-listing","verify_location"),{data:t}).then(function(a){if("country_error"==a.data.status)return $http.post(window.location.href.replace("manage-listing","enter_address"),{data:t}).then(function(t){$("#js-address-container").html($compile(t.data)($scope)),initAutocomplete(),$scope.country=e.country,$("#location_country_field_error").removeClass("hide")}),$("#js-address-container .panel").removeClass("loading"),!1;$("#js-address-container .panel").removeClass("loading"),$("#js-address-container").addClass("location_not_found"),$("#js-address-container").html($compile(a.data)($scope)),setTimeout(function(){initMap()},100)})}),$(document).on("mouseover",'[id^="amenity-tooltip"]',function(){var e=$(this).data("id");$("#ame-tooltip-"+e).show()}),$(document).on("mouseout",'[id^="amenity-tooltip"]',function(){$('[id^="ame-tooltip"]').hide()}),$(document).on("click","#js-next-btn3",function(){var e={};e.country=$scope.country=$("#country").val(),e.address_line_1=$scope.address_line_1=$("#address_line_1").val(),e.address_line_2=$scope.address_line_2=$("#address_line_2").val(),e.city=$scope.city=$("#city").val(),e.state=$scope.state=$("#state").val(),e.postal_code=$scope.postal_code=$("#postal_code").val(),e.latitude=$scope.latitude,e.longitude=$scope.longitude;var t=JSON.stringify(e);$("#js-address-container .panel:first").addClass("loading"),$http.post(window.location.href.replace("manage-listing","finish_address"),{data:t}).then(function(a){if("country_error"==a.data.status)return $http.post(window.location.href.replace("manage-listing","enter_address"),{data:t}).then(function(t){$("#js-address-container").html($compile(t.data)($scope)),initAutocomplete(),$scope.country=e.country,$("#location_country_field_error").removeClass("hide")}),$("#js-address-container .panel").removeClass("loading"),!1;$("#js-address-container .panel").removeClass("loading"),$(".location-map-container-v2").removeClass("empty-map"),$(".location-map-pin-v2").removeClass("moving"),$(".location-map-pin-v2").addClass("set"),$(".address-static-map img").remove(),$(".address-static-map").append('<img style="width:100%; height:275px;" src="https://maps.googleapis.com/maps/api/staticmap?size=570x275&amp;center='+a.data.latitude+","+a.data.longitude+"&amp;zoom=15&amp;maptype=roadmap&amp;sensor=false&key="+map_key+"&amp;markers=icon:"+APP_URL+"/images/map-pin-set-3460214b477748232858bedae3955d81.png%7C"+a.data.latitude+","+a.data.longitude+'">'),$(".panel-body .text-center").remove(),$(".panel-body address").removeClass("hide"),$(".panel-body .js-edit-address-link").removeClass("hide");var s=""!=a.data.address_line_2?" / "+a.data.address_line_2:"";$(".panel-body address span:nth-child(1)").text(a.data.address_line_1+s),$(".panel-body address span:nth-child(2)").text(a.data.city+" "+a.data.state),$(".panel-body address span:nth-child(3)").text(a.data.postal_code),$(".panel-body address span:nth-child(4)").text(a.data.country_name),$('[data-track="location"] a div div .transition').removeClass("visible"),$('[data-track="location"] a div div .transition').addClass("hide"),$('[data-track="location"] a div div div .icon-ok-alt').removeClass("hide"),$("#address-flow-view .modal").fadeOut(),$("#address-flow-view .modal").attr("aria-hidden","true"),$("#steps_count").text(a.data.steps_count),$scope.steps_count=a.data.steps_count,$scope.location_found=!1})}),$(document).on("click",'.modal-close, [data-behavior="modal-close"], .panel-close',function(){$(".modal").fadeOut(),$(".tooltip").css("opacity","0"),$(".tooltip").attr("aria-hidden","true"),$(".modal").attr("aria-hidden","true")}),initAutocomplete(),$scope.location_found=!1,$scope.autocomplete_used=!1,$("#address-flow-view .modal").scroll(function(){$(".pac-container").hide()}),($("#state").val()||""==$("#city").val())&&$("#js-next-btn").prop("disabled",!0),$(document).on("keyup","#state",function(){""==$(this).val()?$("#js-next-btn").prop("disabled",!0):$("#js-next-btn").prop("disabled",!1)}),$(document).on("keyup","#city",function(){""==$(this).val()?$("#js-next-btn").prop("disabled",!0):$("#js-next-btn").prop("disabled",!1)}),$(document).on("click",'[name="amenities"]',function(){var e="";$('[name="amenities"]').each(function(){1==$(this).prop("checked")&&(e=e+$(this).val()+",")});var t=$(this).attr("data-saving");$("."+t+" h5").text("Saving..."),$("."+t).fadeIn(),$http.post("update_amenities",{data:e}).then(function(e){"true"==e.data.success?($("."+t+" h5").text("Saved!"),$("."+t).fadeOut()):""!=e.data.redirect&&null!=e.data.redirect&&(window.location=e.data.redirect)},function(e){"300"==e.status&&(window.location=APP_URL+"/login")})}),$(document).on("click","#photo-uploader",function(){$("#upload_photos").trigger("click")}),$(document).on("click","#js-photo-grid-placeholder",function(){$("#upload_photos2").trigger("click")}),$scope.featured_image=function(e,t){$http.post("featured_image",{id:$("#room_id").val(),photo_id:t}).then(function(e){$scope.photos_list=e.data},function(e){"300"==e.status&&(window.location=APP_URL+"/login")})},upload(),jQuery.extend({handleError:function(e,t,a,s){e.error?e.error(t,a,s):t.responseText&&console.log(t.responseText)}}),jQuery.extend({createUploadIframe:function(e,t){var a,s="jUploadFrame"+e;window.ActiveXObject?((a=document.createElement("iframe")).id=a.name=s,"boolean"==typeof t?a.src="javascript:false":"string"==typeof t&&(a.src=t)):((a=document.createElement("iframe")).id=s,a.name=s);return a.style.position="absolute",a.style.top="-1000px",a.style.left="-1000px",document.body.appendChild(a),a},createUploadForm:function(e,t){var a="jUploadForm"+e,s="jUploadFile"+e,i=jQuery('<form  action="" method="POST" name="'+a+'" id="'+a+'" enctype="multipart/form-data"></form>'),o=jQuery("#"+t),n=jQuery(o).clone();return jQuery(o).attr("id",s),jQuery(o).before(n),jQuery(o).appendTo(i),jQuery(i).css("position","absolute"),jQuery(i).css("top","-1200px"),jQuery(i).css("left","-1200px"),jQuery(i).appendTo("body"),i},ajaxFileUpload:function(e){e=jQuery.extend({},jQuery.ajaxSettings,e);var t=(new Date).getTime(),a=jQuery.createUploadForm(t,e.fileElementId),s=(jQuery.createUploadIframe(t,e.secureuri),"jUploadFrame"+t),i="jUploadForm"+t;e.global&&!jQuery.active++&&jQuery.event.trigger("ajaxStart");var o=!1,n={};e.global&&jQuery.event.trigger("ajaxSend",[n,e]);var d=function(t){var i=document.getElementById(s);try{i.contentWindow?(n.responseText=i.contentWindow.document.body?i.contentWindow.document.body.innerHTML:null,n.responseXML=i.contentWindow.document.XMLDocument?i.contentWindow.document.XMLDocument:i.contentWindow.document):i.contentDocument&&(n.responseText=i.contentDocument.document.body?i.contentDocument.document.body.innerHTML:null,n.responseXML=i.contentDocument.document.XMLDocument?i.contentDocument.document.XMLDocument:i.contentDocument.document)}catch(t){jQuery.handleError(e,n,null,t)}if(n||"timeout"==t){var d;o=!0;try{if("error"!=(d="timeout"!=t?"success":"error")){var r=jQuery.uploadHttpData(n,e.dataType);e.success&&e.success(r,d),e.global&&jQuery.event.trigger("ajaxSuccess",[n,e])}else jQuery.handleError(e,n,d)}catch(t){d="error",jQuery.handleError(e,n,d,t)}e.global&&jQuery.event.trigger("ajaxComplete",[n,e]),e.global&&!--jQuery.active&&jQuery.event.trigger("ajaxStop"),e.complete&&e.complete(n,d),jQuery(i).unbind(),setTimeout(function(){try{jQuery(i).remove(),jQuery(a).remove()}catch(t){jQuery.handleError(e,n,null,t)}},100),n=null}};e.timeout>0&&setTimeout(function(){o||d("timeout")},e.timeout);try{a=jQuery("#"+i);jQuery(a).attr("action",e.url),jQuery(a).attr("method","POST"),jQuery(a).attr("target",s),a.encoding?a.encoding="multipart/form-data":a.enctype="multipart/form-data",jQuery(a).submit()}catch(t){jQuery.handleError(e,n,null,t)}return window.attachEvent?document.getElementById(s).attachEvent("onload",d):document.getElementById(s).addEventListener("load",d,!1),{abort:function(){}}},uploadHttpData:function(r,type){var data=!type;return data="xml"==type||data?r.responseXML:r.responseText,"script"==type&&jQuery.globalEval(data),"json"==type&&eval("data = "+data),"html"==type&&jQuery("<div>").html(data).evalScripts(),data}}),$scope.delete_photo=function(e,t,a,s){$("#js-error .panel-header").text(a),$("#js-error .panel-body").text(s),$(".js-delete-photo-confirm").removeClass("hide"),$("#js-error").attr("aria-hidden",!1),$(".js-delete-photo-confirm").attr("data-id",t);var i=$scope.photos_list.indexOf(e);$(".js-delete-photo-confirm").attr("data-index",i)},$(document).on("click",".js-delete-photo-confirm",function(){var e=$(this).attr("data-index");$http.post("delete_photo",{photo_id:$(this).attr("data-id")}).then(function(t){"true"==t.data.success?($scope.photos_list.splice(e,1),$("#js-error").attr("aria-hidden",!0),$("#steps_count").text(t.data.steps_count),$scope.steps_count=t.data.steps_count):""!=t.data.redirect&&null!=t.data.redirect&&(window.location=t.data.redirect),null!=$scope.photos_list&&(0!=$scope.photos_list.length?($('[data-track="photos"] a div div .transition').removeClass("visible"),$('[data-track="photos"] a div div .transition').addClass("hide"),$('[data-track="photos"] a div div div .icon-ok-alt').removeClass("hide")):($('[data-track="photos"] a div div .transition').removeClass("hide"),$('[data-track="photos"] a div div div .icon-ok-alt').addClass("hide")))},function(e){"300"==e.status&&(window.location=APP_URL+"/login")})}),$scope.$watch("photos_list",function(e){null!=$scope.photos_list&&(0!=$scope.photos_list.length?($('[data-track="photos"] a div div .transition').removeClass("visible"),$('[data-track="photos"] a div div .transition').addClass("hide"),$('[data-track="photos"] a div div div .icon-ok-alt').removeClass("hide")):($('[data-track="photos"] a div div .transition').removeClass("hide"),$('[data-track="photos"] a div div div .icon-ok-alt').addClass("hide")))}),$scope.$watch("steps_count",function(e){null!=$scope.steps_count&&(rooms_status=$("#room_status").val(),0==$scope.steps_count?($("#finish_step").hide(),$(".js-steps-remaining").addClass("hide"),$(".js-steps-remaining").removeClass("show"),rooms_status||($(".listing-nav-sm").addClass("collapsed"),$("body").addClass("non_scrl")),$("#js-list-space-button").css("display",""),$("#js-list-space-tooltip").attr("aria-hidden","false"),setTimeout(function(){$("#js-list-space-tooltip").attr("aria-hidden","true")},3e3),$("#js-list-space-tooltip").css({opacity:"1"}),$("#js-list-space-tooltip").removeClass("animated").addClass("animated")):($("#finish_step").show(),$(".js-steps-remaining").removeClass("hide"),$(".js-steps-remaining").addClass("show"),rooms_status||($(".listing-nav-sm").removeClass("collapsed"),$("body").removeClass("non_scrl")),$("#js-list-space-button").css("display","none"),$("#js-list-space-tooltip").attr("aria-hidden","true"),$("#js-list-space-tooltip").css({opacity:"0"})))}),$scope.keyup_highlights=function(e,t){$http.post("photo_highlights",{photo_id:e,data:t}).then(function(e){""!=e.data.redirect&&null!=e.data.redirect&&(window.location=e.data.redirect)})},$("#href_photos").click(function(){photos_list(),$("#js-manage-listing-nav").removeClass("manage-listing-nav"),$("#js-manage-listing-nav").addClass("pos-abs"),$("#ajax_container").addClass("mar-left-cont")}),$(document).on("change",'[id^="price-select-"]',function(){var e={};e[$(this).attr("name")]=$(this).val(),e.night=$("#price-night").val(),e.currency_code=$("#price-select-currency_code").val();var t=JSON.stringify(e),a=$(this).attr("data-saving");$("."+a+" h5").text("Saving..."),$("."+a).fadeIn(),$http.post("update_price",{data:t}).then(function(e){"true"==e.data.success?(e.data.night_price&&$("#price-night").val(e.data.night_price),$('[data-error="price"]').text(""),$("#price-week").val()<e.data.min_amt?($('[data-error="week"]').removeClass("hide"),$('[data-error="week"]').html(e.data.msg)):($('[data-error="week"]').addClass("hide"),$('[data-error="week"]').text("")),$("#price-month").val()<e.data.min_amt?($('[data-error="month"]').removeClass("hide"),$('[data-error="month"]').html(e.data.msg)):($('[data-error="month"]').addClass("hide"),$('[data-error="month"]').text("")),$('[data-error="weekly_price"]').text(""),$('[data-error="monthly_price"]').text(""),$(".input-prefix").html(e.data.currency_symbol),$("."+a+" h5").text("Saved!"),$("."+a).fadeOut(),$("#steps_count").text(e.data.steps_count),$scope.steps_count=e.data.steps_count):(""!=e.data.redirect&&null!=e.data.redirect&&(window.location=e.data.redirect),$(".input-prefix").html(e.data.currency_symbol),$('[data-error="price"]').html(e.data.msg),$("#price-week").val()<e.data.min_amt?($('[data-error="week"]').removeClass("hide"),$('[data-error="week"]').html(e.data.msg)):($('[data-error="week"]').addClass("hide"),$('[data-error="week"]').text("")),$("#price-month").val()<e.data.min_amt?($('[data-error="month"]').removeClass("hide"),$('[data-error="month"]').html(e.data.msg)):($('[data-error="month"]').addClass("hide"),$('[data-error="month"]').text("")),$("."+a).fadeOut())},function(e){"300"==e.status&&(window.location=APP_URL+"/login")})}),$(document).on("blur",'.autosubmit-text[id^="price-"]',function(){var e={};e[$(this).attr("name")]=$(this).val(),this_val=Math.round($(this).val()),$(this).val(this_val),e.currency_code=$("#price-select-currency_code").val(),"additional_guest"==$(this).attr("name")&&(e.guests=$("#price-select-guests_included").val());var t=JSON.stringify(e),a=$(this).attr("data-saving"),s="price";"night"!=$(this).attr("name")&&(s=$(this).attr("name")),$("."+a+" h5").text("Saving..."),0!=$("#price-night").val()?($("."+a).fadeIn(),$http.post("update_price",{data:t}).then(function(e){"true"==e.data.success?($('[data-error="'+s+'"]').text(""),$(".input-prefix").html(e.data.currency_symbol),$("."+a+" h5").text("Saved!"),$("."+a).fadeOut(),$("#steps_count").text(e.data.steps_count),$scope.steps_count=e.data.steps_count):(""!=e.data.redirect&&null!=e.data.redirect&&(window.location=e.data.redirect),""!=e.data.attribute&&null!=e.data.attribute?($('[data-error="'+e.data.attribute+'"]').removeClass("hide"),$('[data-error="'+e.data.attribute+'"]').html(e.data.msg),$(".input-prefix").html(e.data.currency_symbol)):$('[data-error="price"]').html(e.data.msg),$("."+a).fadeOut()),0!=$("#price-night").val()&&($("#price-night-old").val($("#price-night").val()),e.data.msg||($('[data-track="pricing"] a div div .transition').removeClass("visible"),$('[data-track="pricing"] a div div .transition').addClass("hide"),$('[data-track="pricing"] a div div div .icon-ok-alt').removeClass("hide")))},function(e){"300"==e.status&&(window.location=APP_URL+"/login")})):(0==$("#price-night-old").val()?($("#price-night").val($("#price-night-old").val()),$('[data-track="pricing"] a div div .transition').removeClass("hide"),$('[data-track="pricing"] a div div div .icon-ok-alt').addClass("hide")):($("#price-night").val($("#price-night-old").val()),$('[data-track="pricing"] a div div .transition').removeClass("visible"),$('[data-track="pricing"] a div div .transition').addClass("hide"),$('[data-track="pricing"] a div div div .icon-ok-alt').removeClass("hide")),0==$("#price-night").val()&&($("."+a).fadeIn(),$http.post("update_price",{data:t}).then(function(e){"true"==e.data.success?($('[data-error="'+s+'"]').text(""),$(".input-prefix").html(e.data.currency_symbol),$("."+a+" h5").text("Saved!"),$("."+a).fadeOut(),$("#steps_count").text(e.data.steps_count),$scope.steps_count=e.data.steps_count):(""!=e.data.redirect&&null!=e.data.redirect&&(window.location=e.data.redirect),""!=e.data.attribute&&null!=e.data.attribute?($('[data-error="'+e.data.attribute+'"]').removeClass("hide"),$('[data-error="'+e.data.attribute+'"]').html(e.data.msg),$(".input-prefix").html(e.data.currency_symbol)):$('[data-error="price"]').html(e.data.msg),$("."+a).fadeOut())})))}),$(document).on("change",'[id$="_checkbox"]',function(){if(0==$(this).prop("checked")){var e={},t=$(this).attr("id"),a='[data-checkbox-id="'+t+'"] > div > div > div > input';$(a).val(""),"price_for_extra_person_checkbox"==t&&($('[data-checkbox-id="'+t+'"] > div > div > #guests-included-select > div > select').val(1),e[$('[data-checkbox-id="'+t+'"] > div > div > #guests-included-select > div > select').attr("name")]=0),e[$(a).attr("name")]=$(a).val(),e.currency_code=$("#price-select-currency_code").val();var s=JSON.stringify(e),i=$(a).attr("data-saving");$("."+i+" h5").text("Saving..."),$("."+i).fadeIn(),$http.post("update_price",{data:s}).then(function(e){"true"==e.data.success&&($(".input-prefix").html(e.data.currency_symbol),$("."+i+" h5").text("Saved!"),$("."+i).fadeOut(),$("#steps_count").text(e.data.steps_count),$scope.steps_count=e.data.steps_count)},function(e){"300"==e.status&&(window.location=APP_URL+"/login")})}}),$(document).on("click",'[id^="available-"]',function(){var e={},t=$(this).attr("data-slug");e.calendar_type=t.charAt(0).toUpperCase()+t.slice(1);var a=JSON.stringify(e);$(".saving-progress h5").text("Saving..."),$(".saving-progress").fadeIn(),$http.post("update_rooms",{data:a}).then(function(e){"true"==e.data.success?($scope.selected_calendar=t,$('[data-slug="'+t+'"]').addClass("selected"),$(".saving-progress h5").text("Saved!"),$(".saving-progress").fadeOut(),$("#steps_count").text(e.data.steps_count),$scope.steps_count=e.data.steps_count):""!=e.data.redirect&&null!=e.data.redirect&&(window.location=e.data.redirect),$('[data-track="calendar"] a div div .transition').removeClass("visible"),$('[data-track="calendar"] a div div .transition').addClass("hide"),$('[data-track="calendar"] a div div .pull-right .nav-icon').removeClass("hide")},function(e){"300"==e.status?window.location=APP_URL+"/login":"500"==e.status&&window.location.reload()})}),$(document).on("mouseover",'[id^="available-"]',function(){$('[id^="available-"]').removeClass("selected")}),$(document).on("mouseout",'[id^="available-"]',function(){$('[id="available-'+$scope.selected_calendar+'"]').addClass("selected")});var ex_pathname=window.location.href.split("/");$scope.step=$(ex_pathname).get(-1),photos_list(),$(document).on("click","#finish_step",function(){$http.get("rooms_steps_status",{}).then(function(e){for(var t in e.data)if("0"==e.data[t])return angular.element("#href_"+t).trigger("click"),!1})}),$(document).on("click","#js-list-space-button",function(){var e={status:"Listed"},t=JSON.stringify(e);$http.post("update_rooms",{data:t}).then(function(e){$http.get("rooms_data",{}).then(function(e){$("#symbol_finish").html(e.data.symbol),$scope.popup_photo_name=e.data.photo_name,$scope.popup_night=e.data.night,$scope.popup_room_name=e.data.name,$scope.popup_room_type_name=e.data.room_type_name,$scope.popup_property_type_name=e.data.property_type_name,$scope.popup_state=e.data.state,$scope.popup_country=e.data.country_name,$scope.popup_price=e.data.popup_price,$(".finish-modal").attr("aria-hidden","false"),$(".finish-modal").removeClass("hide")})},function(e){"300"==e.status?window.location=APP_URL+"/login":"500"==e.status&&window.location.reload()})}),$(document).on("blur",'[id^="help-panel"] > textarea',function(){var e={},t=$(this).attr("name"),a=$("#current_tab_code").val();e[t]=$(this).val();var s=JSON.stringify(e);$(".saving-progress h5").text("Saving..."),"neighborhood_overview"!=t&&"transit"!=t?$(".help-panel-saving").fadeIn():$(".help-panel-neigh-saving").fadeIn(),$http.post("update_description",{data:s,current_tab:a}).then(function(e){"true"==e.data.success?($(".saving-progress h5").text("Saved!"),"neighborhood_overview"!=t&&"transit"!=t?$(".help-panel-saving").fadeOut():$(".help-panel-neigh-saving").fadeOut()):""!=e.data.redirect&&null!=e.data.redirect&&(window.location=e.data.redirect)},function(e){"300"==e.status&&(window.location=APP_URL+"/login")})}),$(document).on("click","#collapsed-nav",function(){$("#js-manage-listing-nav").hasClass("collapsed")?$("#js-manage-listing-nav").removeClass("collapsed"):$("#js-manage-listing-nav").addClass("collapsed")}),$(document).on("click",".month-nav",function(){var e=$(this).attr("data-month"),t=$(this).attr("data-year"),a={};a.month=e,a.year=t;var s=JSON.stringify(a);return $(".ui-datepicker-backdrop").removeClass("hide"),$(".spinner-next-to-month-nav").addClass("loading"),$http.post($(this).attr("href").replace("manage-listing","ajax-manage-listing"),{data:s}).then(function(e){$("#ajax_container").html($compile(e.data)($scope)),$(".spinner-next-to-month-nav").removeClass("loading"),$(".ui-datepicker-backdrop").addClass("hide")}),!1}),$(document).on("change","#calendar_dropdown",function(){var e=$(this).val(),t=e.split("-")[0],a=e.split("-")[1],s={};s.month=a,s.year=t;var i=JSON.stringify(s);return $(".ui-datepicker-backdrop").removeClass("hide"),$(".spinner-next-to-month-nav").addClass("loading"),$http.post($(this).attr("data-href").replace("manage-listing","ajax-manage-listing"),{data:i}).then(function(e){$(".ui-datepicker-backdrop").addClass("hide"),$(".spinner-next-to-month-nav").removeClass("loading"),$("#ajax_container").html($compile(e.data)($scope)),init_daterangepicker()}),!1}),$(document).on("click",".tile",function(){if($(this).hasClass("other-day-selected")||$(this).hasClass("selected")||$(this).hasClass("tile-previous"))$(this).hasClass("selected")||($(".first-day-selected").removeClass("first-day-selected"),$(".last-day-selected").removeClass("last-day-selected"),$(".selected").removeClass("selected"),$(".tile-selection-container").remove(),$(".tile-selection-handle").parent().remove(),$(".other-day-selected").removeClass("other-day-selected"),$(".calendar-edit-form").addClass("hide"));else{var e=$(this).attr("id");$("#"+e).addClass("first-day-selected last-day-selected selected"),$('<div class="tile-selection-container"><div class="tile-selection"></div></div>').insertBefore("#"+e+"> .date");$(this).index();var t=$(this).position().top+36,a=$(this).position().left-5,s=t+5,i=a+85;$(".days-container").append('<div><div style="left:'+a+"px;top:"+t+'px;" class="tile-selection-handle tile-handle-left"><div class="tile-selection-handle__inner"><span class="tile-selection-handle__ridge"></span><span class="tile-selection-handle__ridge"></span><span class="tile-selection-handle__ridge"></span></div></div></div><div><div style="left: '+i+"px; top: "+s+'px;" class="tile-selection-handle tile-handle-right"><div class="tile-selection-handle__inner"><span class="tile-selection-handle__ridge"></span><span class="tile-selection-handle__ridge"></span><span class="tile-selection-handle__ridge"></span></div></div></div>'),$(".tile").each(function(){e!=$(this).attr("id")&&$(this).addClass("other-day-selected")}),calendar_edit_form()}}),$(document).on("mouseup",".tile-selection-handle, .tile",function(){selected_li_status=0;var e=$(".selected").last().attr("id"),t=$(".selected").first().attr("id");$("*").removeClass("first-day-selected last-day-selected"),$(".selected").first().addClass("first-day-selected"),$(".selected").last().addClass("last-day-selected");var a=$("#"+e).position(),s=$("#"+t).position();if(null!=a&&null!=s){var i=s.top+35,o=s.left-5,n=a.top+40,d=a.left+80;$(".days-container > div > .tile-selection-handle:last").remove(),$(".days-container > div > .tile-selection-handle:first").remove(),$(".days-container").append('<div><div style="left:'+o+"px;top:"+i+'px;" class="tile-selection-handle tile-handle-left"><div class="tile-selection-handle__inner"><span class="tile-selection-handle__ridge"></span><span class="tile-selection-handle__ridge"></span><span class="tile-selection-handle__ridge"></span></div></div></div><div><div style="left: '+d+"px; top: "+n+'px;" class="tile-selection-handle tile-handle-right"><div class="tile-selection-handle__inner"><span class="tile-selection-handle__ridge"></span><span class="tile-selection-handle__ridge"></span><span class="tile-selection-handle__ridge"></span></div></div></div>'),calendar_edit_form()}});var selected_li_status=0,direction="";$(document).on("mousedown",".tile-selection-handle",function(){selected_li_status=1,direction=$(this).hasClass("tile-handle-left")?"left":"right"});var oldx=0,oldy=0;function calendar_edit_form(){$(".calendar-edit-form").removeClass("hide"),$(".selected").length>1?$(".calendar-edit-form > form > .panel-body").first().show():$(".calendar-edit-form > form > .panel-body").first().hide(),$(".selected").hasClass("status-b")?($scope.$apply(function(){$scope.segment_status="not available"}),$("#unavi").addClass("segmented-control__option--selected"),$("#avi").removeClass("segmented-control__option--selected"),$("#avi").removeClass("segmented-control__option--selected")):($scope.$apply(function(){$scope.segment_status="available"}),$("#avi").addClass("segmented-control__option--selected"),$("#unavi").removeClass("segmented-control__option--selected"),$("#unavi").removeClass("segmented-control__option--selected")),$("#calendar-edit-end").val(""),$("#calendar-edit-start").val("");var e=$(".first-day-selected").first().attr("id"),t=$(".last-day-selected").last().attr("id");if($scope.calendar_edit_price=$("#"+e).find(".price > span:last").text()-0,$(".sidebar-price").val($scope.calendar_edit_price),null==$("#"+e).find(".tile-notes-text").text()?$scope.notes="":$scope.notes=$("#"+e).find(".tile-notes-text").text(),$scope.isAddNote=""!=$scope.notes,e!=t){$("#calendar-edit-start").datepicker({dateFormat:datepicker_format,minDate:0,onSelect:function(e,t){var a=t.selectedMonth+1,s=t.selectedDay+"-"+a+"-"+t.selectedYear;$("#calendar-start").val(s);var i=$("#calendar-edit-start").datepicker("getDate");$("#calendar-edit-end").datepicker("option","minDate",i),setTimeout(function(){$("#calendar-edit-end").datepicker("show")},20)}}),$("#calendar-edit-end").datepicker({dateFormat:datepicker_format,minDate:1,onClose:function(){var e=$("#calendar-edit-start").datepicker("getDate"),t=$("#calendar-edit-end").datepicker("getDate");if($("#calendar-edit-end").datepicker("option","minDate",t),t<=e){var a=$("#calendar-edit-end").datepicker("option","minDate");$("#calendar-edit-end").datepicker("setDate",a)}},onSelect:function(e,t){var a=t.selectedMonth+1,s=t.selectedDay+"-"+a+"-"+t.selectedYear;$("#calendar-end").val(s);var i=$("#calendar-edit-start").datepicker("getDate");$("#calendar-edit-end").datepicker("option","minDate",i),setTimeout(function(){},20)}});var a=new Date(e),s=new Date(t);$("#calendar-edit-start").datepicker("setDate",a),$("#calendar-edit-end").datepicker("setDate",s),$("#calendar-start").val(change_format(e)),$("#calendar-end").val(change_format(t))}else{a=new Date(e),s=new Date(t);$("#calendar-edit-start").datepicker("setDate",a),$("#calendar-edit-end").datepicker("setDate",s),$("#calendar-start").val(change_format(e)),$("#calendar-end").val(change_format(t))}}function change_format(e){if(null!=e){var t=e.split("-");return t[2]+"-"+t[1]+"-"+t[0]}}$(document).on("mouseover",".tile",function(e){if(e.pageX>oldx&&"right"==direction)if(1!=selected_li_status||$(this).hasClass("tile-previous"))$(this).hasClass("tile-previous")&&$(this).trigger("mouseup");else{var t=$(this).attr("id");$("#"+t).removeClass("other-day-selected"),$("#"+t).addClass("selected"),$("#"+$(this).attr("id")+" > div").hasClass("tile-selection-container")||$('<div class="tile-selection-container"><div class="tile-selection"></div></div>').insertBefore("#"+$(this).attr("id")+"> .date");var a=$(".selected").last().index(),s=$(".selected").first().index();$("*").removeClass("first-day-selected last-day-selected"),$(".selected").first().addClass("first-day-selected"),$(".selected").last().addClass("last-day-selected");for(var i=s+1;i<=a;i++){if(0!=$(".days-container > .list-unstyled > li:nth-child("+i+")").attr("class").includes("tile-previous"))return!1;t=$(".days-container > .list-unstyled > li:nth-child("+i+")").attr("id");$("#"+t).addClass("selected"),$("#"+t).removeClass("other-day-selected"),$("#"+t+" > div").hasClass("tile-selection-container")||$('<div class="tile-selection-container"><div class="tile-selection"></div></div>').insertBefore("#"+t+"> .date")}}else if(e.pageX<oldx&&"right"==direction){if(1!=selected_li_status||$(this).hasClass("tile-previous"))$(this).hasClass("tile-previous")&&$(this).trigger("mouseup");else{t=$(".days-container > .list-unstyled > li:nth-child("+$(this).index()+")").next().next().attr("id");var o=$(".days-container > .list-unstyled > li:nth-child("+$(this).index()+")").next().attr("id");$("*").removeClass("first-day-selected last-day-selected"),$(".selected").first().addClass("first-day-selected"),$(".selected").last().addClass("last-day-selected"),$("#"+t).removeClass("selected"),$("#"+t).addClass("other-day-selected"),$(this).removeClass("selected"),$(this).addClass("other-day-selected"),$("#"+o+" > div.tile-selection-container").remove()}0==$(".selected").length&&(selected_li_status=0,$(".tile").each(function(){$(this).removeClass("other-day-selected last-day-selected first-day-selected"),$(".tile-selection-container").remove(),$(".tile-selection-handle").remove()}))}if(e.pageX>oldx&&"left"==direction)if(1!=selected_li_status||$(this).hasClass("tile-previous"))$(this).hasClass("tile-previous")&&$(this).trigger("mouseup");else{t=$(".days-container > .list-unstyled > li:nth-child("+$(this).index()+")").attr("id"),o=$(".days-container > .list-unstyled > li:nth-child("+$(this).index()+")").attr("id");$("*").removeClass("first-day-selected last-day-selected"),$(".selected").first().addClass("first-day-selected"),$(".selected").last().addClass("last-day-selected"),$("#"+t).removeClass("selected"),$("#"+t).addClass("other-day-selected"),$(this).removeClass("selected"),$(this).addClass("other-day-selected"),$("#"+o+" > div.tile-selection-container").remove()}else if(e.pageX<oldx&&"left"==direction){if(1!=selected_li_status||$(this).hasClass("tile-previous"))$(this).hasClass("tile-previous")&&$(this).trigger("mouseup");else{t=$(".days-container > .list-unstyled > li:nth-child("+$(this).index()+")").next().next().attr("id"),o=$(".days-container > .list-unstyled > li:nth-child("+$(this).index()+")").next().attr("id");$("#"+t).addClass("selected"),$("#"+t).removeClass("other-day-selected"),$(this).addClass("selected"),$(this).removeClass("other-day-selected");for(a=$(".selected").last().index(),i=(s=$(".selected").first().index())+1;i<=a;i++){if(0!=$(".days-container > .list-unstyled > li:nth-child("+i+")").attr("class").includes("tile-previous"))return!1;t=$(".days-container > .list-unstyled > li:nth-child("+i+")").attr("id");$("#"+t).addClass("selected"),$("#"+t).removeClass("other-day-selected"),$("#"+t+" > div").hasClass("tile-selection-container")||$('<div class="tile-selection-container"><div class="tile-selection"></div></div>').insertBefore("#"+t+"> .date"),$("#"+t).removeClass("first-day-selected last-day-selected")}$("*").removeClass("first-day-selected last-day-selected"),$(".selected").first().addClass("first-day-selected"),$(".selected").last().addClass("last-day-selected"),$("#"+t+" > div").hasClass("tile-selection-container")||$('<div class="tile-selection-container"><div class="tile-selection"></div></div>').insertBefore("#"+t+"> .date")}0==$(".selected").length&&(selected_li_status=0,$(".tile").each(function(){$(this).removeClass("other-day-selected last-day-selected first-day-selected"),$(".tile-selection-container").remove(),$(".tile-selection-handle").remove()}))}if(e.pageY>oldy&&"right"==direction)if(1!=selected_li_status||$(this).hasClass("tile-previous"))$(this).hasClass("tile-previous")&&$(this).trigger("mouseup");else{t=$(this).attr("id");$("#"+t).removeClass("other-day-selected"),$("#"+t).addClass("selected"),$("#"+$(this).attr("id")+" > div").hasClass("tile-selection-container")||$('<div class="tile-selection-container"><div class="tile-selection"></div></div>').insertBefore("#"+$(this).attr("id")+"> .date");a=$(".selected").last().index(),s=$(".selected").first().index();$("*").removeClass("first-day-selected last-day-selected"),$(".selected").first().addClass("first-day-selected"),$(".selected").last().addClass("last-day-selected");for(i=s+1;i<=a;i++){if(0!=$(".days-container > .list-unstyled > li:nth-child("+i+")").attr("class").includes("tile-previous"))return!1;t=$(".days-container > .list-unstyled > li:nth-child("+i+")").attr("id");$("#"+t).addClass("selected"),$("#"+t).removeClass("other-day-selected"),$("#"+t+" > div").hasClass("tile-selection-container")||$('<div class="tile-selection-container"><div class="tile-selection"></div></div>').insertBefore("#"+t+"> .date")}}if(e.pageY<oldy&&"right"==direction)if(1!=selected_li_status||$(this).hasClass("tile-previous"))$(this).hasClass("tile-previous")&&$(this).trigger("mouseup");else if(!$(this).hasClass("selected")){t=$(this).attr("id"),a=$(this).index(),s=$(".selected").first().index();$(".selected").addClass("other-day-selected"),$(".selected").removeClass("selected");for(i=s+1;i<=a+1;i++){var n=$(".days-container > .list-unstyled > li:nth-child("+i+")").attr("class");console.log(n);for(i=s+1;i<=a+1;i++){if(0!=$(".days-container > .list-unstyled > li:nth-child("+i+")").attr("class").includes("tile-previous"))return!1;t=$(".days-container > .list-unstyled > li:nth-child("+i+")").attr("id");$("#"+t).addClass("selected"),$("#"+t).removeClass("other-day-selected"),$("#"+t+" > div").hasClass("tile-selection-container")||$('<div class="tile-selection-container"><div class="tile-selection"></div></div>').insertBefore("#"+t+"> .date")}}$("*").removeClass("first-day-selected last-day-selected"),$(".selected").first().addClass("first-day-selected"),$(".selected").last().addClass("last-day-selected")}if(e.pageY<oldy&&"left"==direction)if(1!=selected_li_status||$(this).hasClass("tile-previous"))$(this).hasClass("tile-previous")&&$(this).trigger("mouseup");else{t=$(this).attr("id");$("#"+t).removeClass("other-day-selected"),$("#"+t).addClass("selected"),$("#"+$(this).attr("id")+" > div").hasClass("tile-selection-container")||$('<div class="tile-selection-container"><div class="tile-selection"></div></div>').insertBefore("#"+$(this).attr("id")+"> .date");a=$(".selected").last().index(),s=$(".selected").first().index();$("*").removeClass("first-day-selected last-day-selected"),$(".selected").first().addClass("first-day-selected"),$(".selected").last().addClass("last-day-selected");for(i=s+1;i<=a;i++){if(0!=$(".days-container > .list-unstyled > li:nth-child("+i+")").attr("class").includes("tile-previous"))return!1;t=$(".days-container > .list-unstyled > li:nth-child("+i+")").attr("id");$("#"+t).addClass("selected"),$("#"+t).removeClass("other-day-selected"),$("#"+t+" > div").hasClass("tile-selection-container")||$('<div class="tile-selection-container"><div class="tile-selection"></div></div>').insertBefore("#"+t+"> .date")}}if(e.pageY>oldy&&"left"==direction)if(1!=selected_li_status||$(this).hasClass("tile-previous"))$(this).hasClass("tile-previous")&&$(this).trigger("mouseup");else if(!$(this).hasClass("selected")){t=$(this).attr("id"),s=$(this).index(),a=$(".selected").last().index();$(".selected").addClass("other-day-selected"),$(".selected").removeClass("selected");for(i=s+1;i<=a+1;i++){if(0!=$(".days-container > .list-unstyled > li:nth-child("+i+")").attr("class").includes("tile-previous"))return!1;t=$(".days-container > .list-unstyled > li:nth-child("+i+")").attr("id");$("#"+t).addClass("selected"),$("#"+t).removeClass("other-day-selected"),$("#"+t+" > div").hasClass("tile-selection-container")||$('<div class="tile-selection-container"><div class="tile-selection"></div></div>').insertBefore("#"+t+"> .date")}$("*").removeClass("first-day-selected last-day-selected"),$(".selected").first().addClass("first-day-selected"),$(".selected").last().addClass("last-day-selected")}oldx=e.pageX,oldy=e.pageY}),$scope.calendar_edit_submit=function(e){$scope.calendar_edit_price=$(".get_price ").val()-0,$http.post("calendar_edit",{status:$scope.segment_status,start_date:$("#calendar-start").val(),end_date:$("#calendar-end").val(),price:$scope.calendar_edit_price,notes:$scope.notes}).then(function(t){$scope.notes="";var a=$("#calendar_dropdown").val(),s=a.split("-")[0],i=a.split("-")[1],o={};o.month=i,o.year=s;var n=JSON.stringify(o);return $(".ui-datepicker-backdrop").removeClass("hide"),$(".spinner-next-to-month-nav").addClass("loading"),$http.post(e.replace("manage-listing","ajax-manage-listing"),{data:n}).then(function(e){$(".ui-datepicker-backdrop").addClass("hide"),$(".spinner-next-to-month-nav").removeClass("loading"),$("#ajax_container").html($compile(e.data)($scope))}),!1},function(e){"300"==e.status&&(window.location=APP_URL+"/login")})},$(document).on("change","#availability-dropdown > div > select",function(){var e={};e.status=$(this).val();var t=JSON.stringify(e);$http.post("update_rooms",{data:t}).then(function(t){"Unlisted"==e.status?($("#availability-dropdown > i").addClass("dot-danger"),$("#availability-dropdown > i").removeClass("dot-success")):"Listed"==e.status&&($("#availability-dropdown > i").removeClass("dot-danger"),$("#availability-dropdown > i").addClass("dot-success"))},function(e){"300"==e.status?window.location=APP_URL+"/login":"500"==e.status&&window.location.reload()})}),$(document).on("click","#export_button",function(){$("#export_popup").attr("aria-hidden","false")}),$(document).on("click","#import_button",function(){$("#import_popup").attr("aria-hidden","false")}),$(document).on("click",".remove_sync_button",function(){$("#remove_sync_popup").attr("aria-hidden","false"),$(".remove_sync_cal_container").addClass("loading"),$http.post(APP_URL+"/get_sync_calendar",{room_id:$("#room_id").val()}).then(function(e){$scope.sync_cal_details=e.data,$(".remove_sync_cal_container").removeClass("loading")})}),$scope.show_confirm_popup=function(e){$("#remove_sync_popup").attr("aria-hidden","true"),$("#remove_sync_confirm_popup").attr("aria-hidden","false"),$(".remove_ical_link").attr("data-ical_id",e)},$scope.remove_sync_cal=function(){$(".remove_sync_confirm_panel").addClass("loading");var e=$(".remove_ical_link").attr("data-ical_id");$http.post(APP_URL+"/remove_sync_calendar",{ical_id:e}).then(function(e){$(".remove_sync_confirm_panel").removeClass("loading"),$(".modal").attr("aria-hidden","true")})},$scope.booking_select=function(e){var t={};t.booking_type=e;var a=JSON.stringify(t);$http.post("update_rooms",{data:a}).then(function(t){"true"==t.data.success&&($("#before_select").addClass("hide"),$("#"+e).removeClass("hide"))},function(e){"300"==e.status?window.location=APP_URL+"/login":"500"==e.status&&window.location.reload()})},$scope.booking_change=function(e){var t={booking_type:""},a=JSON.stringify(t);$http.post("update_rooms",{data:a}).then(function(t){"true"==t.data.success&&($("#before_select").removeClass("hide"),$("#"+e).addClass("hide"))},function(e){"300"==e.status?window.location=APP_URL+"/login":"500"==e.status&&window.location.reload()})},$scope.add_price_rule=function(e){"length_of_stay"==e?(new_period=$scope.length_of_stay_period_select,$scope.length_of_stay_items.push({period:new_period-0}),$scope.length_of_stay_period_select=""):"early_bird"==e?$scope.early_bird_items.push({period:""}):"last_min"==e&&$scope.last_min_items.push({period:""})},$scope.remove_price_rule=function(e,t){"length_of_stay"==e?(item=$scope.length_of_stay_items[t],$scope.length_of_stay_items.splice(t,1),errors=$scope.ls_errors):"early_bird"==e?(item=$scope.early_bird_items[t],$scope.early_bird_items.splice(t,1),errors=$scope.eb_errors):"last_min"==e&&(item=$scope.last_min_items[t],$scope.last_min_items.splice(t,1),errors=$scope.lm_errors),errors[t]=[],""!=item.id&&item.id&&($("#js-"+e+"_wrapper").addClass("loading"),$http.post("delete_price_rule/"+item.id,{}).then(function(t){$("#js-"+e+"_wrapper").removeClass("loading")}))},$scope.length_of_stay_option_avaialble=function(e){var t=$filter("filter")($scope.length_of_stay_items,{period:e},!0),a=$filter("filter")($scope.length_of_stay_items,{period:""+e},!0);return!t.length&&!a.length},$(document).on("change",".ls_period, .ls_discount",function(){index=$(this).attr("data-index"),$scope.update_price_rules("length_of_stay",index)}),$(document).on("change",".eb_period, .eb_discount",function(){index=$(this).attr("data-index"),$scope.update_price_rules("early_bird",index)}),$(document).on("change",".lm_period, .lm_discount",function(){index=$(this).attr("data-index"),$scope.update_price_rules("last_min",index)}),$scope.update_price_rules=function(e,t){if("length_of_stay"==e?(rules=$scope.length_of_stay_items,errors=$scope.ls_errors):"early_bird"==e?(rules=$scope.early_bird_items,errors=$scope.eb_errors):"last_min"==e&&(rules=$scope.last_min_items,errors=$scope.lm_errors),data=rules[t],null==data.discount)return!1;$("#js-"+e+"-rm-btn-"+t).attr("disabled","disabled"),$(".price_rules-"+e+"-saving h5").text($scope.saving_text),$(".price_rules-"+e+"-saving").fadeIn(),$http.post("update_price_rules/"+e,{data:data}).then(function(a){"true"!=a.data.success?errors[t]=a.data.errors:(errors[t]=[],rules[t].id=a.data.id),$(".price_rules-"+e+"-saving h5").text($scope.saved_text),$(".price_rules-"+e+"-saving").fadeOut(),$("#js-"+e+"-rm-btn-"+t).removeAttr("disabled")})},$scope.remove_availability_rule=function(e){item=$scope.availability_rules[e],type="availability_rules",""!=item.id&&item.id&&($("#"+type+"_wrapper").addClass("loading"),$http.post("delete_availability_rule/"+item.id,{}).then(function(e){$("#"+type+"_wrapper").removeClass("loading")})),$scope.availability_rules.splice(e,1)},$scope.edit_availability_rule=function(e){item=$scope.availability_rules[e],$("#calendar-rules-custom").removeClass("hide"),$("#calendar-rules-custom").addClass("show"),$scope.availability_rule_item=angular.copy(item),$scope.availability_rule_item.type="prev",$scope.availability_rule_item.start_date=$scope.availability_rule_item.start_date_formatted,$scope.availability_rule_item.end_date=$scope.availability_rule_item.end_date_formatted,$scope.$$phase||$scope.$apply(),$scope.availability_datepickers()},$scope.availability_rules_type_change=function(){rule=$scope.availability_rule_item,"custom"!=rule.type&&(this_elem=$("#availability_rule_item_type option:selected"),start_date=this_elem.attr("data-start_date"),end_date=this_elem.attr("data-end_date"),$scope.availability_rule_item.start_date=start_date,$scope.availability_rule_item.end_date=end_date)},$scope.availability_datepickers=function(){var e=$("#availability_rules_start_date"),t=$("#availability_rules_end_date");e.datepicker({minDate:0,dateFormat:datepicker_format,onSelect:function(a,s){var i=e.datepicker("getDate");i.setDate(i.getDate()+1),t.datepicker("option","minDate",i),$scope.availability_rule_item.start_date=e.val()}}),t.datepicker({minDate:1,dateFormat:datepicker_format,onSelect:function(e,a){t.datepicker("getDate");$scope.availability_rule_item.end_date=t.val()}})},$scope.copy_data=function(e){return angular.copy(e)},$(document).ready(function(){$scope.availability_datepickers()}),$(document).on("click","#js-calendar-settings-btn",function(){$("#calendar-rules").addClass("show")}),$(document).on("click","#js-close-calendar-settings-btn",function(){$("#calendar-rules").removeClass("show")}),$(document).on("click","#js-add-availability-rule-link",function(){$("#calendar-rules-custom").removeClass("hide"),$("#calendar-rules-custom").addClass("show"),$scope.availability_rule_item={type:"",start_date:"",end_date:"",start_date_formatted:"",end_date_formatted:""},$scope.$$phase||$scope.$apply(),$scope.availability_datepickers()}),$(document).on("click","#js-close-availability-rule-btn, #js-cancel-availability-rule-btn",function(){$("#calendar-rules-custom").removeClass("show"),$("#calendar-rules-custom").addClass("hide")}),$(document).on("change",".reservation_settings_inputs",function(){data={},$(".reservation_settings_inputs").each(function(e,t){field=$(t),data[field.attr("name")]=field.val()}),$(".reservation_settings-saving h5").text($scope.saving_text),$(".reservation_settings-saving").fadeIn(),$http.post("update_reservation_settings",data).then(function(e){"true"!=e.data.success?$scope.rs_errors=e.data.errors:$scope.rs_errors=[],$(".reservation_settings-saving h5").text($scope.saved_text),$(".reservation_settings-saving").fadeOut()})}),$scope.update_availability_rule=function(){data={availability_rule_item:$scope.availability_rule_item},$("#availability_rule_item_wrapper, #availability_rules_wrapper").addClass("loading"),$http.post("update_availability_rule",data).then(function(e){"true"!=e.data.success?$scope.ar_errors=e.data.errors:($scope.ar_errors=[],$scope.availability_rules=e.data.availability_rules,$("#js-close-availability-rule-btn").trigger("click"),$("#calendar-rules-custom").addClass("hide")),$("#availability_rule_item_wrapper, #availability_rules_wrapper").removeClass("loading")})}}]),app.directive("limitTo",[function(){return{restrict:"A",link:function(e,t,a){var s=parseInt(a.limitTo);angular.element(t).on("keypress",function(e){var t=window.event?e.keyCode:e.which;if(this.value.length==s){if(8==e.keyCode||46==e.keyCode||37==e.keyCode||39==e.keyCode)return!0;e.preventDefault()}else{if(8==e.keyCode||46==e.keyCode||37==e.keyCode||39==e.keyCode)return!0;(t<48||t>57)&&e.preventDefault()}})}}}]),$(document).on("click","#write-description-button",function(){$("#write-description-button").attr("disabled",!0)});var pathname=document.getElementById("href_calendar").href;$(location).attr("href")==pathname&&($(".listing-nav-sm").removeClass("collapsed"),$("body").removeClass("non_scrl")),$(".list-nav-link a").click(function(){$(".listing-nav-sm").removeClass("collapsed"),$("body").removeClass("non_scrl")}),window.setInterval(function(){$(".listing-nav-sm").hasClass("collapsed")?$("body").addClass("non_scrl"):$("body").removeClass("non_scrl")},10),$("#href_pricing").click(function(){$("#js-manage-listing-nav").removeClass("manage-listing-nav"),$("#js-manage-listing-nav").addClass("pos-abs"),$("#ajax_container").addClass("mar-left-cont")}),$("#href_terms").click(function(){$("#js-manage-listing-nav").removeClass("manage-listing-nav"),$("#js-manage-listing-nav").addClass("pos-abs"),$("#ajax_container").addClass("mar-left-cont")}),$("#remove-manage").click(function(){$("#js-manage-listing-nav").removeClass("manage-listing-nav"),$("#js-manage-listing-nav").addClass("pos-abs"),$("#ajax_container").addClass("mar-left-cont")}),$("#href_booking").click(function(){$("#js-manage-listing-nav").removeClass("manage-listing-nav"),$("#js-manage-listing-nav").addClass("pos-abs"),$("#ajax_container").addClass("mar-left-cont")}),$("#href_basics").click(function(){$("#js-manage-listing-nav").removeClass("manage-listing-nav"),$("#js-manage-listing-nav").addClass("pos-abs"),$("#ajax_container").addClass("mar-left-cont")}),$("#href_description").click(function(){$("#js-manage-listing-nav").removeClass("manage-listing-nav"),$("#js-manage-listing-nav").addClass("pos-abs"),$("#ajax_container").addClass("mar-left-cont")}),$("#href_location").click(function(){$("#js-manage-listing-nav").removeClass("manage-listing-nav"),$("#js-manage-listing-nav").addClass("pos-abs"),$("#ajax_container").addClass("mar-left-cont")}),$("#href_amenities").click(function(){$("#js-manage-listing-nav").removeClass("manage-listing-nav"),$("#js-manage-listing-nav").addClass("pos-abs"),$("#ajax_container").addClass("mar-left-cont")}),$("#href_details").click(function(){$("#js-manage-listing-nav").removeClass("manage-listing-nav"),$("#js-manage-listing-nav").addClass("pos-abs"),$("#ajax_container").addClass("mar-left-cont")}),$("#href_guidebook").click(function(){$("#js-manage-listing-nav").removeClass("manage-listing-nav"),$("#js-manage-listing-nav").addClass("pos-abs"),$("#ajax_container").addClass("mar-left-cont")}),$("#href_calendar").click(function(){$("#js-manage-listing-nav").removeClass("manage-listing-nav"),$("#js-manage-listing-nav").addClass("pos-abs"),$("#ajax_container").addClass("mar-left-cont")}),$(document).ready(function(){$("#js-edit-address").click(function(){$("body").addClass("pos-fix4")}),$(".modal-close").click(function(){$("body").removeClass("pos-fix4")})});